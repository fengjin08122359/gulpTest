"use strict";function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t,a){var i="<span data-index='$index' data-tab='$tab' >$title<i></i></span>",n="<div data-index='$index' class='iframe'><iframe src='$url' frameborder='0' scrolling='scroll'></iframe></div>",o=function(e,a){this.$el=e,this.defaults={relatedEl:null},this.options=t.extend({},this.defaults,a)};o.prototype={current:0,data:[],init:function(){var a=this;a.resize(),a.$el.find(".tab_title").delegate("span","click",function(){a.current=t(this).data("index"),t(this).addClass("active"),t(this).siblings().removeClass("active");var e=a.$el.find(".tab_main .iframe[data-index='"+a.current+"']");e.addClass("active"),e.siblings().removeClass("active")}),a.$el.find(".tab_title").delegate("span i","click",function(){var e=t(this).parent().data("index");a.remove(e)}),t(e).resize(function(e){a.resize()})},add:function(e,t,a){var o=this,s=o.data.length;0==o.$el.find(".tab_title span[data-tab='"+e+"']").length?(o.data[s]=e,o.$el.find(".tab_title").append(i.replace(/\$title/g,t).replace(/\$index/g,s).replace(/\$tab/g,e)),o.$el.find(".tab_main").append(n.replace(/\$url/g,a).replace(/\$index/g,s)),1!=e&&2!=e||o.$el.find(".tab_title span").last().find("i").remove(),o.current=s,o.$el.find(".tab_title span[data-index='"+s+"']").click()):o.$el.find(".tab_title span[data-tab='"+e+"']").click(),o.resize()},resize:function(){var e=this;0==e.$el.find(".tab_title span").length?(e.$el.css("width",0),e.options.relatedEl.css("right",0)):t("body").width()>900?(e.$el.css("width","486px"),e.options.relatedEl.css("right","486px")):t("body").width()>768?(e.$el.css("width","430px"),e.options.relatedEl.css("right","430px")):(e.$el.css("width",0),e.options.relatedEl.css("right",0))},remove:function(e){var t=this,a=t.$el.find(".tab_title span[data-index='"+e+"']"),i=a.prev().length>0?a.prev():a.next();a.remove(),t.$el.find(".tab_main .iframe[data-index='"+e+"']").remove(),i&&i.length>0&&i.click(),t.resize()}},t.fn.tab=function(e){var a=new o(t(this),e);return a.init(),a}}(window,jQuery),function(e,t,a){var i=function(e,a){this.$el=e,this.defaults={},this.options=t.extend({},this.defaults,a)};i.prototype={show:function(e){if(e&&"undefined"!=e&&"null"!=e){var t=this.$el;t.html(""),t.find(".systemInfo").remove(),t.append('<div class="systemInfromBox systemInfo">'+e+"</div>")}},hide:function(){var e=this.$el;e.find(".systemInfo").remove()}},t.fn.systemInfo=function(e){var a=new i(t(this),e);return a}}(window,jQuery),function(e,t,a){var i=function(e,a){this.$el=e,this.defaults={},this.options=t.extend({},this.defaults,a)};i.prototype={init:function(){var e=this;e.$el.each(function(a,i){e.show(t(this))})},show:function(e){e.data("label")&&("static"==e.css("position")&&e.css("position","relative"),e.append('<div class="label">'+e.data("label")+"</div>"),e.find(".label").width(12*e.find(".label").text().length),e.hover(function(){e.find(".label").show()},function(){e.find(".label").hide()}))}},t.fn.showLabel=function(e){var a=new i(t(this),e);return a.init(),a}}(window,jQuery),function(e,t,a){var i=function(e){this.defaults={companyPk:"",after:function(e){},init:function(){},hide:function(){}},this.options=t.extend({},this.defaults,e)};i.prototype={msg:"",ok:!0,init:function(){this.options.init()},check:function(e){this.checkNew(e)},checkNew:function(e){var a=this;a.ok&&e||a.options.hide(),e!=a.msg&&a.ok&&e&&(a.msg=e,t.ajax({type:"POST",url:"echatManager.do",data:{method:"getSimilarQuestions",companyPk:a.options.companyPk,visitorId:a.options.visitorId,chatId:a.options.chatId,channel:"web",question:e,top:3},dataType:"json",async:!1}).done(function(e){e&&a.options.newAfter(e)}).fail(function(){a.ok=!1}))},checkOld:function(e){var a=this;a.ok&&e||a.options.hide(),e!=a.msg&&a.ok&&e&&(a.msg=e,t.ajax({type:"post",url:"./qaInterface.do",data:{method:"searchForQuestionByKeywords",companyPk:a.options.companyPk,question:e},dataType:"json",async:!1}).done(function(e){0!=e.success?a.options.after(e):a.ok=!1}).fail(function(){a.ok=!1}))},hide:function(){this.options.hide()}},t.visitorRobot=function(e){var t=new i(e);return t}}(window,jQuery),function(e,t,a){var i=function(e){this.defaults={fs:{fontSize:"14px",color:"#000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",lineHeight:"14px",fontFamily:"微软雅黑"},storage:null,initFun:function(e){}},this.options=t.extend({},this.defaults,e)};i.prototype={fs:{fontSize:"14px",color:"#000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",lineHeight:"14px",fontFamily:"微软雅黑"},init:function(){var e=this.options.storage,t=e.get("fs");t&&(this.fs=t),this.options.initFun(t)},isShow:function(){return this.options.fs!=this.fs},set:function(e,t){var a=this.options.storage;this.fs[e]=t,a.set("fs",this.fs)},get:function(e){this.options.storage;return"undefined"!=typeof e?this.fs[e]:""}},t.fontStyle=function(e){var t=new i(e);return t.init(),t}}(window,jQuery),function(e,t,a){var i=function(e){this.defaults={aDset:{vcwTitleZhcn:"UCC访客端界面",vcwLftAdZhcn:"./style/images/echat/ad.html",vcwLogoZhcn:"./style/css/images/ucc-logo.png"}},this.options={aDset:{vcwTitleZhcn:e.aDset.vcwTitleZhcn?e.aDset.vcwTitleZhcn:this.defaults.aDset.vcwTitleZhcn,vcwLftAdZhcn:e.aDset.vcwLftAdZhcn?e.aDset.vcwLftAdZhcn:this.defaults.aDset.vcwLftAdZhcn,vcwLogoZhcn:e.aDset.vcwLogoZhcn?e.aDset.vcwLogoZhcn:this.defaults.aDset.vcwLogoZhcn}}};i.prototype={setTitle:function(){},setTab:function(){tab.add("2","简介",this.options.aDset.vcwLftAdZhcn)}},t.setSkin=function(e){var t=new i(e);return t}}(window,jQuery),function(e){function t(e){var t=parseInt(e.substr(1),16);return(t>>>16)+(t>>>8&255)+(255&t)<500}e.fn.colorPicker=function(a){var i={color:new Array("#FFFFFF","#EEEEEE","#FFFF88","#FF7400","#CDEB8B","#6BBA70","#006E2E","#C3D9FF","#4096EE","#356AA0","#FF0096","#B02B2C","#702D86","#000000"),defaultColor:0,columns:0,click:function(e,t){}},n=e.extend({},i,a);return this.each(function(){for(var a=e(this),i=e.meta?e.extend({},n,a.data()):n,o="number"==typeof i.defaultColor?i.defaultColor:-1,s="",c=0;c<i.color.length;c++)s+='<div style="background-color:'+i.color[c]+';"></div>',o==-1&&i.defaultColor==i.color[c]&&(o=c);a.html('<div class="jColorSelect">'+s+"</div>");var r=a.children(".jColorSelect").children("div"),l=(r.width()+2+2)*(i.columns>0?i.columns:i.color.length);a.children(".jColorSelect").css("width",l),r.each(function(a){e(this).click(function(){if(o!=a){if(o>-1){var n=r.eq(o);n.hasClass("check")&&n.removeClass("check").removeClass("checkwht").removeClass("checkblk")}o=a,e(this).addClass("check").addClass(t(i.color[a])?"checkwht":"checkblk"),i.click(i.color[a],a)}})});var d=o;o=-1,r.eq(d).trigger("click")})}}(jQuery),function(e,t,a){var i=function(e){this.defaults={os:{},draw:function(e){},download:function(){}},this.options=t.extend({},this.defaults,e)};i.prototype={outTime:6e4,startTime:0,using:!1,failOp:0,scinterval:null,os:null,title:"",type:1,http:"http://local.any800.com:20201/",https:"https://local.any800.com:20202/",url:"",onClick:!1,init:function(){this.title=t("title").html(),this.os=this.options.os;var e="https:"==document.location.protocol;e?this.url=this.https:this.url=this.http,t(".screenCaptureCheckBox .checked").toggleClass("active",!!datas.get("screenCapture")),this.getBrowserName()},use:function(){if(!this.onClick){this.onClick=!0,this.type=!datas.get("screenCapture");var e=Number(!!this.type),a=this.browserName;t("title").html(this.title+"-截屏中"),t("iframe.screenCapture").remove(),t("html").append("<iframe class='screenCapture' style='position:absolute;visibility:hidden;top: 0;left: 0;'  src='hfxyz:\\\\"+(e?"show":"hidden?pn="+a+"&title="+encodeURIComponent(this.title))+"' frameborder='0'></iframe>"),this.startTime=(new Date).getTime(),this.using=!1,this.failOp=0,this.startCheck()}},getBrowserName:function(){var e=this.os.browserName;switch(e){case"msie":e="iexplore";break;case"metasr":e="SogouExplorer";break;case"qqbrowser":e="QQBrowser";break;case"firefox":e="firefox";break;case"chrome":e="chrome";break;case"msie":e="iexplore"}if("chrome"==e){var t=navigator.mimeTypes["application/vnd.chromium.remoting-viewer"];t&&(e="360se")}this.browserName=e},startCheck:function(){var e=this;this.scinterval&&clearInterval(this.scinterval),(new Date).getTime()-this.startTime>this.outTime||(this.scinterval=setInterval(function(){t.ajax({url:e.url+"index.html",dataType:"jsonp",jsonpCallback:"success_jsonpCallback"}).done(function(t){console.log("time"+(new Date).getTime()),e.failOp=0,1==t.test&&t.data?(e.using=!0,e.options.draw(t.data),e.close()):0==t.test&&e.close()}),e.failOp>10&&e.download(),e.failOp++},500))},close:function(){this.scinterval&&clearInterval(this.scinterval),this.onClick=!1,t("title").html(this.title),t("iframe.screenCapture").remove(),t("html").append("<iframe class='screenCapture' style='position:absolute;visibility:hidden'  src='"+this.url+"close.html' frameborder='0'></iframe>")},download:function(){this.scinterval&&clearInterval(this.scinterval),this.onClick=!1,e.ScreenCapture||this.hasDownload||(this.hasDownload=!0,this.options.download())},checkIE:function(){var e=t(".screenCaptureIframe");e.length<1&&(t("body").append('<div class="screenCaptureIframe" style="height:0px;width:0px;"></div>'),e=t(".screenCaptureIframe")),e.html(""),e.html('<object id="capture" type="application/x-hfxyz2" width="0" height="0"><param name="onerror" value="onerrorHandler" /><param name="onload" value="onloadHandler" /></object>')}},t.screenCapture=function(e){var t=new i(e);return t.init(),t}}(window,$),function(e,t,a){var i=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};i.prototype={screenCapture:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){screenCapture=t.screenCapture({os:userDatas.getOperatingSystem(),draw:function(e){uccPcEvent.uploadImgFromPaste("data:image/.png;base64,"+e,"paste",!1)},download:function(){Alert.show("请下载安装。"),e.open("/any800/Any800Capture.html","Any800Capture")}})}),leaveCover:function(){0==t(".leaveMessage").length&&(t(".dialogue-area").append("<div class='leaveMessage'>已断开连接，请刷新重试</div>"),t(".leaveMessage").css({position:"absolute",bottom:"130px",left:"13px"}),setInterval(function(){t(".leaveMessage").fadeIn(500).fadeOut(500)},1e3))},openCover:function(){t(".leaveMessage").remove()},repaceImg:function(){var e=t(".contentMessage").last().find("img[originsrc]");e.length>0&&e.attr("src",e.attr("originsrc"))},rightClickOnImg:function(){t(".dialogue-record").delegate(".contentMessage .content img","mousedown",function(e){if(!t(this).attr("emotions")&&3==e.which)return uccPcEvent.rightClick(e.clientX,e.clientY,t(this).attr("originsrc")||t(this).attr("src")),e.preventDefault(),!1}),t(".dialogue-record").delegate(".contentMessage .content img","mouseup",function(e){if(!t(this).attr("emotions"))return e.preventDefault(),!1}),t(".dialogue-record-c").on("scroll",function(){t(".rightClick").remove()}),t(e).resize(function(e){t(".rightClick").remove()})},rightClick:function(a,i,n){0==t(".rightClick").length&&(t("body").append("<div class='rightClick'>下载</div>"),t(".rightClick")[0].oncontextmenu=function(){return!1}),t(".rightClick").css("top",i-2),t(".rightClick").css("left",a-2),t(".rightClick").unbind().on("click",function(){uccPcEvent.downloadOrigin(n).done(function(t){e.open(t)})})},downloadOrigin:function(e){var a=new t.Deferred,i=e.substring(e.lastIndexOf(".")),n=i.toLowerCase(),o=e.substring(0,e.lastIndexOf("."));if(o.indexOf("origin")>-1)return a.resolve(e);if(".jpg"==n||".jpeg"==n||".png"==n||".bmp"==n){var s=o+"origin"+i,c=new Image;if(c.src=s,c.complete)return a.resolve(s);c.onload=function(){return a.resolve(s)},c.onerror=function(){return a.resolve(e)}}return a.promise()},cacheImg:function(e,t,a){var i=new Image;return i.src=t,i.complete?void a.call(i):void(i.onload=function(){a.call(i)})},unload:function(){t(e).unload(function(){storage.get("offChat")==ucc.browserId&&storage.set("offChat",!0),webSocket.isWork&&webSocket.websocket.close()})},messageChange:function(){t("#message").delegate(".message_news","click",function(){t(this).data("url")&&e.open(t(this).data("url"))})},addEvent:function(){var a=this;t("body").delegate(".fanke-liuyan","click",function(){leaveMessage.show()}),t("#message").delegate(".dialogue-me .dialogue-in-c .content img,.dialogue-in .dialogue-in-c .content img","click",function(){"true"!=t(this).attr("emotions")&&showBigImgFun.showPic(t(this).attr("originsrc")||t(this).attr("src"))}),a.toolsEvnt(ucc.buttonList),a.rightClickOnImg(),t(".send").click(function(){(dialogue.islive()||robot.isUse)&&a.sendMsg()}),t("#close").click(function(){if(dialogue.islive()){var e=confirm("您确定要结束对话吗？");1==e&&(a.closeChat(),t("#close").css("cursor",""))}}),t(".ucc-logo-cancel").click(function(){if(dialogue.islive()){var i=confirm("您确定要结束对话吗？");1==i&&(a.closeChat(),t("#close").css("cursor",""))}else{var i=confirm("您确定要关闭对话框吗？");1==i&&e.close()}}),t(document).keydown(function(e){a.glint.clear(),(dialogue.islive()||robot.isUse)&&a.sendKeyDown(e)}),t("body").click(function(){a.glint.clear()})},toolsEvnt:function(a){for(var i=this,n=0;n<a.length;n++)switch(a[n].type){case 1:t(".tool1").show();var o=ucc.aDset,s="echatManager.do?method=showFaq&companyPk="+ucc.companyPk+"&langPk="+ucc.defaultLangPk+"&codeKey="+o.vcwColor;tab.add("1","常见问题",s),t(".tool1").click(function(){tab.add("1","常见问题",s)});break;case 2:t(".tool2").show();break;case 3:t(".tool3").show();break;case 4:t(".tool4").show(),t(".tool4 .screenCapture").click(function(){screenCapture.use(),t(".screenCaptureCheckBox").hide()}),t(".tool4 .screenCaptureCheck").click(function(){t(".screenCaptureCheckBox").toggle()}),t(".screenCaptureCheckBox").click(function(e){t(".screenCaptureCheckBox .checked").toggleClass("active"),datas.set("screenCapture",t(".screenCaptureCheckBox .checked").hasClass("active")),t(".screenCaptureCheckBox").hide()}),t(e).click(function(e){var a=t(e.target);0==a.closest(t(".screenCaptureCheckBox")[0]).length&&t(".screenCaptureCheckBox").hide()});break;case 5:t(".tool9").show().click(function(){i.saveDialog()});break;case 6:t(".tool6").show().click(function(){satisfaction.show()});break;case 7:t(".tool5").click(function(){i.createSendFile()});break;case 8:t(".tool7").show().click(function(){i.sendAudioRq()});break;case 12:t(".tool10").show(),i.sendPicture(),t("#picUpload>div").width(26).height(21)}},sendScreen:function(){screenCapture.use()},saveDialog:function(){var a=this.getChatContent();a=encodeURIComponent(a);var i;if(e.frames&&e.frames.downloadFrame);else{try{i=document.createElement('<iframe name="downloadFrame" style="display:none;">')}catch(n){i=document.createElement("iframe"),i.style="display:none;",i.setAttribute("style","display:none;")}i.id="downloadFrame",i.name="downloadFrame",i.width=0,i.height=0,i.marginHeight=0,i.marginWidth=0;var o=document.getElementsByTagName("body").item(0);o.insertBefore(i,o.firstChild)}var s;if(t("#downloadForm").length>0)s=t("#downloadForm")[0];else{s=document.createElement("form");var c="post";s.setAttribute("method",c),s.setAttribute("name","downloadForm"),s.setAttribute("id","downloadForm"),s.setAttribute("action","echat/downloadChat.jsp"),s.setAttribute("target","downloadFrame")}var r;t("#htmlContent").length>0?r=t("#htmlContent")[0]:(r=document.createElement("input"),r.setAttribute("type","hidden"),r.setAttribute("name","htmlContent"),r.setAttribute("id","htmlContent")),r.setAttribute("value",a),s.appendChild(r);var l=document.getElementsByTagName("body").item(0);l.insertBefore(s,l.firstChild),s.submit()},getChatContent:function(){var e='<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>对话记录</title>';e+="<link type='text/css' rel='stylesheet' href='"+baseUrl+"/style/css/echat/ucc.css'/></head><body style='overflow:auto;visibility: visible;'>";var a=t("#message").clone();return a.children("#historyChat,#moreHistory").remove(),e+=a.html().replace(/\/any800\/style\/images/g,baseUrl+"/style/images"),e+="</body></html>"},createSendFile:function(){var e=this,a=t(".label-pop .sendFile");if(0==a.length){var i="<div class='sendFile'><div class='name'></div><div class='ok'>浏览</div><div class='submit'>发送</div></div>";t(".label-pop").append(i),e.uploader=t(".label-pop .sendFile .ok").uploadFile({size:10485760,uploadType:"all",other:function(e,a,i){t(".label-pop .sendFile .ok").find(".fileup").attr("action","/any800/echatManager.do?method=uploadFile&fromType=visitor&chatId="+ucc.chatID),t(".label-pop .sendFile .name").html(a)},callback:function(e,a,i,n){var o=e,s='访客发送了一个文件：<a class = "download" target="_blank" href="'+o+'">下载</a>';(o.indexOf(".jpg")>-1||o.indexOf(".bmp")>-1||o.indexOf(".jpeg")>-1||o.indexOf(".gif")>-1||o.indexOf(".png")>-1)&&(s="<img id='img' "+(n?"originsrc='"+n+"'":"")+" data-symbol='"+a+"' src='"+o+"'>"),dialogue.sendMessage(s,""),t(".label-pop .sendFile .name").html(""),t(".sendFile").hide(),t(".tool5").removeClass("click")},error:function(e,t,a,i){a&&Alert.show(a),"type"==e?Alert.show("仅支持上传.gif.jpg.jpeg.bmp.png.doc.docx.xls.xlsx.pdf.txt格式的文件"):"size"==e?Alert.show("仅支持上传10M以内的文件"):Alert.show("上传文件错误")}}),t(".label-pop .sendFile .submit").on("click",function(){""!=t(".label-pop .sendFile .name").html()?e.uploader.submit(""):Alert.show("请选择文件")})}else t(".sendFile").toggle(),t(".label-pop .sendFile .name").html(""),e.uploader&&e.uploader.create()},sendAudioRq:function(){dialogue.sendMessage("vistorSendRq","vistorSendRq")},sendPicture:function(){t("#picUpload").uploadFile({size:5242880,uploadType:"image",other:function(e,a,i){t("#picUpload").find(".fileup").attr("action","/any800/echatManager.do?method=uploadFile&fromType=visitor&chatId="+ucc.chatID),e.submit(i)},callback:function(e,a,i,n){setTimeout(function(){var a="<img "+(n?"originsrc='"+n+"'":"")+" src='"+e+"'>";t(".dialogue-area-write").append(a)},500)},error:function(e,t,a,i){a&&Alert.show(a),"type"==e?Alert.show("仅支持上传.png.jpeg.bmp.jpg格式的图片"):"size"==e?Alert.show("仅支持上传5M以内的图片"):Alert.show("上传图片错误")}})},sendMsg:function(){var e=this;if(datas.get("canSend")){datas.set("canSend",!1);var a=e.getMsgStr();if("unable"==a||""==a)return void datas.set("canSend",!0);var i=new RegExp("<br>","g");if(a.replace(i,"")){var n=/<img\s*src="data:image\/.{0,5};base64,/i;dialogue.islive()?(n.test(a)?t.ajax({type:"POST",async:"false",url:"echatManager.do?method=getScreenshotSrc&chatId="+ucc.chatID,data:{sendMsg:a},dataType:"json"}).done(function(e){if(e.success){var t=e.content;uccPcEvent.storeImg(t).done(function(e){a='<img id="img" src="'+e+'">',dialogue.sendMessage(a),detectWeb.msgPush("visitor",a)})}else e.errorMsg&&Alert.show(e.errorMsg)}):(dialogue.sendMessage(a),detectWeb.msgPush("visitor",a)),datas.set("openSatisfactionAfterCloseChat",!0)):robot.isUse&&robot.check(a.replace(/\&nbsp;/g,"").replace(/\s+/g,"").replace(/\<p><\/p>/g,"").replace(/\<br>/g,""))}setTimeout(function(){e.clearSend(),datas.set("canSend",!0)},10)}},getMsgStr:function(){var e=t(".dialogue-area-write").clone(),a=t(".dialogue-area-write").html();a=changeFaceFun.imgToIco(e.html());var i=/<a[^>]*href=['"]([^"]*)['"].*?[^>]*>(.*?)<\/a>/g,n=a.match(i);if(n)for(d=0;d<n.length;d++)a=a.replace(n[d],RegExp.$2);a=sensitive.get(a);try{var o=a.replace(/\&nbsp;/g,"").replace(/\<p><\/p>/g,"");0==o.length&&(a=o)}catch(s){}var c=/<img\s*src="data:image\/.{0,5};base64,/i,r=new RegExp("<br>","g");if(a=a.replace(/<div\s*>|<\/div>|<span\s*>|<\/span>|<p\s*>|<\/p>/g,"").replace(/<\/?[p|P][^>]*>/g,""),!c.test(a)&&a.replace(r,"")){if(a.length>1e3)return Alert.show("最大长度为1000个字符"),"unable";a=a.replace(/<\/?[p|P][^>]*>/g,"")}a.replace(r,"")&&(e.find("p").each(function(){t(this).replaceWith(t(this).html()+"<br/>"),a=e.html()}),e.find("img").each(function(){if("faceIco"==t(this).attr("name")){var i=this.id;t(this).replaceWith(i),a=e.html()}}));var l=a.match(/<img.*?>/g);if(l&&l.length>0){for(var d in l)l[d]&&!isNaN(Number(d))&&(a=a.replace(l[d],"</span>"+l[d]+"<span>"));a="<span>"+a+"</span>"}return e=t("<div>"+a+"</div>"),e.find("span").each(function(){t(this).replaceWith(t(this).html().replace(/ /gi,"&nbsp;").replace(/\n/gi,"<br>")),a=e.html()}),e.html()},clearSend:function(){var a=e.navigator.userAgent;/MSIE 8/g.test(a)?t(".dialogue-area-write")[0].innerHTML="&nbsp;":t(".dialogue-area-write").html(""),t(".dialogue-area-write").focus()},closeChat:function(){dialogue.islive()&&(1==ucc.BasicSetting.jump&&datas.get("openSatisfactionAfterCloseChat")&&!datas.get("hasSatisfaction")&&satisfaction.show(),dialogue.end(5),t("#face_08").css("display","none"),t(".sendFile").hide())},sendKeyDown:function(t){var a=this,t=arguments[0]||e.event||t;t.target||e.event.srcElement;if(88==t.keyCode&&t.ctrlKey&&t.shiftKey)return!1;if(13==t.keyCode&&0==ucc.sendKey){if(!t.ctrlKey&&!t.shiftKey)return a.sendMsg(),!1;try{var i;return i=document.createRange?document.createRange():document.selection.createRange(),i.text="\r\n",i.collapse(!1),i.select(),!1}catch(n){}}else if(13==t.keyCode&&1==ucc.sendKey){if(t.ctrlKey||t.shiftKey)return a.sendMsg(),!1;try{var i;return i=document.createRange?document.createRange():document.selection.createRange(),i.text="\r\n",i.collapse(!1),i.select(),!1}catch(n){}}},glint:{time:0,title:document.title,timer:null,titleGlitterFlag:0,show:function(){var e=this,t=this.title.replace("【　　　】","").replace("【新消息】","");return this.timer=setTimeout(function(){e.time++,e.show(),e.time%2==0?document.title="【新消息】"+t:document.title="【　　　】"+t},600),[this.timer,this.title]},clear:function(){clearTimeout(this.timer),document.title=this.title,this.titleGlitterFlag=0}},titleGlitter:function(){0==this.glint.titleGlitterFlag&&this.glint.show(),this.glint.titleGlitterFlag=1},closeChatSatisfaction:function(){1==ucc.BasicSetting.jump&&datas.get("openSatisfactionAfterCloseChat")&&!datas.get("hasSatisfaction")&&satisfaction.show()},scrollTop:function(){t(".dialogue-record-c")[0]&&(t(".dialogue-record-c")[0].scrollTop=t(".dialogue-record-c")[0].scrollHeight)},showAdvertisement:function(){var e=parseInt(ucc.advertisement.isVisable),t=parseInt(ucc.advertisement.accessDisplay),a=parseInt(ucc.advertisement.visitorWaiting),i=parseInt(ucc.advertisement.beforeDisplayTime);if(1==e&&(2==t||1==t)){if(ucc.advertisement.startTime&&ucc.advertisement.endTime){var n=ucc.advertisement.startTime;n.indexOf(":")>-1&&(n=n.replace(":",""));var o=ucc.advertisement.endTime;o.indexOf(":")>-1&&(o=o.replace(":",""));var s=new Date,c=s.getHours()<10?"0"+s.getHours():s.getHours(),r=s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes(),l=c+""+r}var d=new RegExp("&quot;","g");parseInt(n)<=parseInt(l)&&parseInt(l)<=parseInt(o)&&(2==a?setTimeout(function(){dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:ucc.advertisement.content.replace(d,'"'),from:"client",status:0,saveIn:1})},1e3*i):dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:ucc.advertisement.content.replace(d,'"'),from:"client",status:0}))}},showFile:function(e){var a=t(".tool5");if(0!=a.length){if("on"==e){t(".tool5").show(),storage.set("canSendFile",!0);var i="客服已经为您打开发送文件功能，要使用请点击面板上的按钮"}else{t(".tool5").hide(),t(".sendFile").hide();var i="客服已经关闭发送文件功能";storage.set("canSendFile",!1)}dialogue.showSysMsg(i)}},openWin:function(e){t("<div>"+e+"</div>").find("a").each(function(){var e=t(this).attr("href"),a=t(this).text(),i=/^(下载|转人工)/.test(a);e&&!i&&tab.add(a,a,e,"1")})},saveTopicType:function(e){t.ajax({type:"POST",url:"echatManager.do",data:{method:"saveTopicType",topicType:e,chatId:ucc.chatID,companyPk:ucc.companyPk},dataType:"json"})},showAudio:function(){t("audio").each(function(e,a){if(!t(a).parent().hasClass("audiojs")){var i=t(this);audiojs.helpers.whenError=function(){var e=t(".dialogue-in-c").find("a[placeholder]");e.html("下载")},audiojs.create(i)}})},reconnectClick:!1,initFaceJs:function(){function a(e,a){fontStyle;1==e?"weight"==a?(t(".dialogue-area-write").css("fontWeight","bold"),fontStyle.set("fontWeight","bold")):"em"==a?(t(".dialogue-area-write").css("font-style","italic"),fontStyle.set("fontStyle","italic")):"decoration"==a&&(t(".dialogue-area-write").css("text-decoration","underline"),fontStyle.set("textDecoration","underline")):2==e&&("weight"==a?(t(".dialogue-area-write").css("fontWeight","normal"),fontStyle.set("fontWeight","normal")):"em"==a?(t(".dialogue-area-write").css("font-style","normal"),fontStyle.set("fontStyle","normal")):"decoration"==a&&(t(".dialogue-area-write").css("text-decoration","none"),fontStyle.set("textDecoration","none")))}t(".area-top-p span").showLabel(),t("#font1").click(function(){t("#font1-c").is(":hidden")?t("#font1-c").show():t("#font1-c").hide()}),t("#font2").click(function(){t("#font2-c").is(":hidden")?t("#font2-c").show():t("#font2-c").hide()}),t("#font1-c span").click(function(){var e=t(this).text();t("#font1").text(e),t("#font1-c").hide(),t(".dialogue-area-write").css("font-family",e),fontStyle.set("fontFamily",e)}),t("#font2-c span").click(function(){var e=t(this).text();t("#font2").text(e),t("#font2-c").hide(),t(".dialogue-area-write").css("font-size",e+"px"),t(".dialogue-area-write").css("line-height",e+"px"),fontStyle.set("fontSize",e+"px"),fontStyle.set("lineHeight",e+"px")}),t(".dialogue-area-top .font").toggle(function(){t(this).addClass("font-current-click");var e=t(this).attr("id");a(1,e)},function(){t(this).removeClass("font-current-click");var e=t(this).attr("id");a(2,e)}),t("#font-color").click(function(){fontStyle;t("#color_picker").colorPicker({defaultColor:fontStyle.get("defaultColor")?fontStyle.get("defaultColor"):13,columns:14,click:function(e,a){t(".dialogue-area-write").css("color",e),t("#font-color").css("background-color",e),fontStyle.set("color",e),fontStyle.set("defaultColor",a)}}).toggle()}),t("#font-color").click(),t("#color_picker").hide(),t(".tool4").toggle(function(){t(this).addClass("click")},function(){t(this).removeClass("click")}),t(".tool5").toggle(function(){t(this).addClass("click")},function(){t(this).removeClass("click")}),t(".tool7").toggle(function(){t(this).addClass("click")},function(){t(this).removeClass("click")}),t(".send-key-c p").click(function(){t(this).children(".send-ok").addClass("send-ok-ok"),ucc.sendKey=t(this).children(".send-ok").attr("data-send"),storage.set("sendKey",ucc.sendKey),t(this).siblings(".send-key-c p").children(".send-ok").removeClass("send-ok-ok"),t(".send-key").hide()}),t(".send-key-c p .send-ok[data-send='"+storage.get("sendKey")+"']").click(),t(".send-select").click(function(a){var i=e.event||a;i.stopPropagation?i.stopPropagation():i.cancelBubble=!0,t(".send-key").show()}),t(".send-key").click(function(t){var a=e.event||t;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}),t(".tool3").click(function(a){t(".tool2-c").hide(),t(".tool2").removeClass("click");var i=e.event||a;i.stopPropagation?i.stopPropagation():i.cancelBubble=!0,t(".face-c").is(":hidden")?(t(".face-c").show(),t(this).addClass("click")):(t(".face-c").hide(),t(this).removeClass("click")),t(".lable3").hide()}),t(".tool2").click(function(a){t(".face-c").hide(),t(".tool3").removeClass("click");var i=e.event||a;i.stopPropagation?i.stopPropagation():i.cancelBubble=!0,t(".tool2-c").is(":hidden")?(t(".tool2-c").show(),t(this).addClass("click")):(t(".tool2-c").hide(),t(this).removeClass("click")),t(".lable2").hide()}),t(".face-c").click(function(t){var a=e.event||t;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}),t(document).click(function(){t(".send-key").hide(),t(".face-c").hide(),t(".tool3").removeClass("click")}),t(".messagerecord").click(function(){var e="historyOperator.do?method=moreHistoryDialogue&visitorId="+userDatas.getVisitorInfo().visitorId+"&companyPk="+ucc.companyPk,t="消息记录";tab.add(t,t,e)}),t("#tab_title li[index=1] a,#tab_title li[index=2] a").remove();var i=t("#liuyan-c input[type='text']").length,n=t("#liuyan-c textarea").length,o=t("#liuyan-content").height();o=o-48*(5-i)-90*(1-n),t("#liuyan-content").height(o+"px");var s=this;t("#message").delegate(".reconnectID","click",function(){dialogue.islive()||datas.get("hasInQueue")||s.reconnectClick||(s.reconnectClick=!0,t.ajax({type:"POST",url:"./echat.do",data:{method:"closeEchat",chatID:ucc.chatID,url:dialogue.getAttr("remoteUrl"),opname:dialogue.getAttr("operatroName")?dialogue.getAttr("operatroName"):""},success:function(e){},dataType:"json",async:!1,cache:!1}),t.ajax({url:"./echatManager.do",data:{method:"initChatId",companyPk:ucc.companyPk,vid:userDatas.getVisitorInfo().visitorId,hjUserData:params.hjUserData},dataType:"json",async:!1,cache:!1}).done(function(e){try{ucc.chatID=e.chatID,storage.set("oldChatId",e.chatID),ucc.browserId=(new Date).getTime(),localHistory.saveCurrent(),datas.set("openSatisfactionAfterCloseChat",!1),datas.set("hasSatisfaction",!1),datas.set("adv",!1);userDatas.getJsonStr();uccPcInit.initFunc(),uccPcLogic.addmonitorJs(),detectWeb.setIsReconnection(!0),queue.reqStartQueue(storage.get("businessId"),storage.get("businessName"),detectWeb.getIsReconnection()),s.reconnectClick=!1}catch(e){}}).fail(function(e){s.reconnectClick=!1,dialogue.showSysMsg("网络异常，请确保网络正常后再重新连接！")}))}),t("img[defsrc]").each(function(e,a){t(this).attr("src",t(this).attr("defsrc"))})},initPaste:function(){var a=this;t.fn.pasteFun=function(){var e=t(this);try{e.designMode="On"}catch(n){}e.bind({paste:function(n){if(dialogue.islive()){var o=!1;if(n.clipboardData||n.originalEvent){var s=n.clipboardData||n.originalEvent.clipboardData;if(s&&s.items){var c=s.items,r=c.length,l=null;o=!0;for(var d=0;d<r;d++)c[d].type.indexOf("image")!==-1&&(l=c[d].getAsFile());if(null!==l){n.preventDefault();var u=new FileReader;u.onload=function(e){var t=e.target.result;a.uploadImgFromPaste(t,"paste",o)},u.readAsDataURL(l)}}else setTimeout(function(){var i,n=e.find("img"),s=n.length,c="";for(i=0;i<s;i++)"img"!==n[i].id&&n[i].src.length>100&&(c=n[i].src,t(n[i]).remove());a.uploadImgFromPaste(c,"paste",o)},1)}else setTimeout(function(){var i,n=e.find("img"),s=n.length,c="";for(i=0;i<s;i++)"img"!==n[i].id&&n[i].src.length>100&&(c=n[i].src,t(n[i]).remove());a.uploadImgFromPaste(c,"paste",o)},1);setTimeout(function(){var e=t(".dialogue-area-write").html();e=changeFaceFun.imgToIco(e),e=t("<div>"+e+"</div>").text(),e=changeFaceFun.icoToImg(e),t(".dialogue-area-write").html(e),i(t(".dialogue-area-write")[0])},1)}}})};var i=function(t){if(e.getSelection){t.focus();var a=e.getSelection();a.selectAllChildren(t),a.collapseToEnd()}else if(document.selection){var a=document.selection.createRange();a.moveToElementText(t),a.collapse(!1),a.select()}};navigator.appVersion.split(";")[1]&&"MSIE9.0"==navigator.appVersion.split(";")[1].replace(/[ ]/g,"")||t(".dialogue-area-write").pasteFun()},uploadImgFromPaste:function(e,a,i){var n=this,o='<img src="'+e+'">',s=/<img\s*src="data:image\/.{0,5};base64,/i;s.test(o)&&t.ajax({type:"POST",async:"false",url:"./echatManager.do?method=getScreenshotSrc&fromType=visitor&chatId="+ucc.chatID,data:{sendMsg:o},dataType:"json"}).done(function(e){if(e.success){var a=t("<div>"+e.content+"</div>").find("img"),i=a.attr("src"),o=a.attr("originsrc")||a.attr("src");n.storeImg(i).done(function(e){var a='<img id="img" src="'+e+'" '+(o?"originsrc='"+o+"'":"")+">";t(".dialogue-area-write").append(a)})}else e.errorMessage&&Alert.show(e.errorMessage)})},storeImg:function(e){var a=new t.Deferred,i=new Image;return i.src=e,i.complete?a.resolve(e):(i.onload=function(){return a.resolve(e)},i.onerror=function(){return a.resolve(e)},a.promise())}},t.uccPcEvent=function(e){var t=new i(e);return t}}(window,jQuery),function(e,t,a){var i=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};i.prototype={showBusinessList:function(e){var a=this;if(!dialogue.islive()){var i="";if(t("#bl").html(""),datas.get("iswork")){
var n=bList.generate(e);if(n)if(n.access){if(n.online)return bList.setSelect(n.pk,n.name),storage.set("businessId",n.pk),storage.set("businessName",n.name),void queue.reqStartQueue(n.pk,n.name);if(t("#message").html("<div class='service-info'><div style='line-height:18px;'>您好!欢迎使用在线客服系统,很高兴为您服务!<br/><p id='bl'></p>如果客服忙或者客服不在线,请选择在线<span class='dialogue-a' id='fangke-liuyan'>留言</span></div></div>"),t("#fangke-liuyan").click(function(){leaveMessage.show()}),!n.name)return;var o="离线";i+='<p><a data-online="离线" name="'+n.name+'" data-pk="'+n.pk+'">'+n.name+"【离线】</a></p>"}else{n.root||(i+='<p><a class="back" >返回上级</a></p>');for(var s=n.list,c=0;c<s.length;c++){var r=s[c],o="online"==r.type?"在线":"离线";i+='<p><a data-online="'+o+'" name="'+r.item.name+'" data-pk="'+r.item.pk+'">'+r.item.name+"【"+o+"】</a></p>"}}t("#bl").html(i),t(".service-info").find(".back").unbind().click(function(){a.showBusinessList(bList.getParentPk(e))}),t(".service-info").find("a[name]").unbind().click(function(){var e=t(this).data("pk"),i=t(this).attr("name");if(bList.hasList(e).length>0)return void a.showBusinessList(e);workTime.show();t(this).html();"在线"==t(this).data("online")?(bList.setSelect(e,i),queue.reqStartQueue(e,i)):leaveMessage.show()}),t(".service-info").find("a[class='dialogue-a']").click(function(){leaveMessage.show()})}}},loadScheme:function(){var e=this;pageLoad.getDepartment().done(function(){bList=t.businessList({businessList:ucc.businessList,aDset:ucc.aDset}),e.showBusinessList("-1")})},checkRobot:function(){t(".send").removeAttr("disabled"),t(".dialogue-area-write").attr("contentEditable","true")},initWelcome:function(){dialogue.islive()||(robot.isUse?langTip.show("2","1"):(langTip.show("1","1"),langTip.show("1","2")))},toggleV:function(){if(1==ucc.BasicSetting.need){var e=storage.get("isSave");0!=e&&visitorInformation.show()}},initFont:function(){t(".dialogue-area-write").css("color",fontStyle.get("color")),t(".dialogue-area-write").css("font-weight",fontStyle.get("fontWeight")),t(".dialogue-area-write").css("font-style",fontStyle.get("fontStyle")),t(".dialogue-area-write").css("text-decoration",fontStyle.get("textDecoration")),t(".dialogue-area-write").css("font-size",fontStyle.get("fontSize")),t(".dialogue-area-write").css("line-height",fontStyle.get("lineHeight")),t(".dialogue-area-write").css("font-family",fontStyle.get("fontFamily")),t(".tool2-c #font1-c span").each(function(e,a){t(this).text()==fontStyle.get("fontFamily")&&t(this).click()}),t(".tool2-c #font2-c span").each(function(e,a){t(this).text()==fontStyle.get("fontSize")&&t(this).click()}),"normal"!=fontStyle.get("fontWeight")&&t(".tool2-c .tool-font3 #weight").click(),"normal"!=fontStyle.get("fontStyle")&&t(".tool2-c .tool-font3 #em").click(),"none"!=fontStyle.get("textDecoration")&&t(".tool2-c .tool-font3 #decoration").click(),"none"!=fontStyle.get("textDecoration")&&t(".tool2-c .tool-font3 #decoration").click(),"#000000"!=fontStyle.get("color")&&t("#font-color").css("background-color",fontStyle.get("color"))},addmonitorJs:function(){setTimeout(function(){dialogue.islive()||(monitor=t.monitor({storage:storage,companyPk:ucc.companyPk,userDatas:userDatas}))},3e3)}},t.uccPcLogic=function(e){var t=new i(e);return t}}(window,jQuery),function(e,t,a){var i=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};i.prototype={initBasic:function(){params=t.getParameter(),Alert=t.Alert(),showBigImgFun=t.showBigImg(),showBigImgFun.init(),storage=t.storage({companyPk:ucc.companyPk}),msgdb=t.msgdb(),datas=t.db({storage:storage}),localHistory=t.localHistory({storage:storage}),localHistory.init(),tab=t(".tab_info").tab({relatedEl:t(".dialogue")}),systemInfo=t("#sysmsg").systemInfo(),userDatas=t.userDatas({param:params,storage:storage,storageVisitor:"visitor",storageIpStr:"ipStr",storageChatNum:"chatNum",companyPk:ucc.companyPk,aDset:ucc.aDset,businessId:"",businessName:""}),skin=t.setSkin({aDset:ucc.aDset}),visitLimit=t.visitLimit({open:params.vl?params.vl:1,storage:storage}),visitLimit.init(),fontStyle=t.fontStyle({storage:storage}),workTime=t.workTime({BasicSetting:ucc.BasicSetting,ExtraSetting:ucc.ExtraSetting,show:function(e){if(e&&0==t(".pop_bg").length){var a='<div class="dialogue-in"><p class="dialogue-pic"><img src="./style/css/images/service.png"></p><div class="dialogue-in-r"><p class="in-name">客服</p><div class="dialogue-in-c"><span class="d-dot1"><img src="./style/css/images/d-dot1.png"></span><p><span>'+e+"</span></p></div></div></div>";t("#message").html(a),datas.set("iswork",!1),setTimeout(function(){t(".pop_msg").slideDown("slow")},300)}}}),sensitive=t.sensitive({vocabulary:ucc.vocabulary}),changeFaceFun=t.changeFace({after:function(){for(var e=this.imgIco,a="",i=0,n=e.length;i<n;i++){var o=e[i][0];a+="<p><span class='face-pic'>"+o+"</span></p>"}t(".face-c").html(a),t(".face-pic").hover(function(){t(this).addClass("hover"),t(this).siblings(".face-text").show()},function(){t(this).removeClass("hover"),t(this).siblings(".face-text").hide()}),t(".face-pic").click(function(){t(".tool3").removeClass("click"),t(".face-c").hide();var e=t(this).find("img").clone();t(".dialogue-area-write").append(e)})}})},initData:function(){var e=new t.Deferred;return datas.set("canSend",!0),datas.set("iswork",!0),datas.set("hasInQueue",!1),ucc.sendKey=storage.get("sendKey")?storage.get("sendKey"):0,t.ajax({type:"POST",url:"./echatManager.do",data:{method:"initChatId",companyPk:ucc.companyPk,vid:userDatas.getVisitorInfo().visitorId,hjUserData:params.hjUserData,visitorInfo:params.visitorInfo},dataType:"json",async:!1,cache:!1}).done(function(e){ucc.chatID=e.chatID,ucc.browserId=(new Date).getTime(),storage.get("oldChatId")!=e.chatID?(storage.get("msgObjCurrentChat")&&t.ajax({type:"POST",url:"./echat.do",async:"false",data:{method:"closeEchat",chatID:storage.get("oldChatId"),url:storage.get("msgObjCurrentChat").url,opname:datas.get("opName")?datas.get("opName"):""},success:function(e){},dataType:"json"}),uccPcLogic.addmonitorJs(),localHistory.saveCurrent(),storage.set("oldChatId",e.chatID),datas.set("openSatisfactionAfterCloseChat",!1),datas.set("hasSatisfaction",!1),datas.set("adv",!1)):"connnected"==e.state&&(storage.set("offChat",ucc.browserId),storage.set("browserId",ucc.browserId))}),webSocket=t.webSocket({path:"/any800/UccWebSocket/",isWs:ucc.isWs,visitorId:userDatas.getVisitorInfo().visitorId,message:function(e,t,a){e==ucc.chatID&&("object"==("undefined"==typeof t?"undefined":_typeof(t))&&(t=JSON.stringify(t)),msgdb.get(a)||(dialogue.showMsg({msgid:a,date:(new Date).getTime(),content:t,from:"client"}),detectWeb.msgPush("customer",t),uccPcEvent.titleGlitter(),TimeoutList.startALLTimeout()))},deal:function(e,a,i){if(a==ucc.chatID)if("CUTOMER_IS_INVITED"==e){if(dialogue.toolFun(!0),dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:i,from:"client",saveIn:1}),detectWeb.getIsReconnection()){var n="["+detectWeb.getMsgs(5).join(",")+"]";dialogue.sendMessage(n,"offLineMessage")}TimeoutList.startALLTimeout()}else if("CLOSE"==e)detectWeb.getIsInitiate()?dialogue.end(6):dialogue.end(2),t("#face_08").css("display","none"),t(".sendFile").hide();else if("CLOSE_CUSTOMER"==e)dialogue.end(3),t("#face_08").css("display","none"),t(".sendFile").hide();else if("CLOSE_VISITOR"==e)dialogue.islive()&&(langTip.show(langTip.type.system,langTip.key.no_answer_close),t("#face_08").css("display","none"),t(".sendFile").hide());else if("OPERATION_TIPS"==e)if("pushsatisfaction"==i.params.opType)satisfaction.show();else if("sendFileEntry"==i.params.opType)uccPcEvent.showFile(i.params.flag);else if("getinfo"==i.params.opType)visitorInformation.show();else if("foreknowledge"==i.params.opType){var o=t(".reminder").length;if(0!=o)"1"==i.content?t(".reminder").show():t(".reminder").hide();else{var s='<div class= "reminder"><div class="rp"></div>对方正在输入...</div>';t("body").append(s),t(".reminder").css({position:"absolute",bottom:"164px",left:"5px"})}}else"uploadfile"==i.params.opType&&dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:i.content,from:"client",status:0});else if("CUSTOMER_NETWORK_INTERRUPT"==e)dialogue.end(7),t("#face_08").css("display","none"),t(".sendFile").hide();else if("CUTOMER_ISNOT_INVITED"==e)dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:i,from:"client",status:0}),dialogue.end(0);else if("CUTOMER_REVOKE"==e){msgdb.set(i,"isRevoke",!0),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db);var c=t("div[name="+i+"]");"none"!=c.css("display")&&(c.hide(),c.after("<div class='msg_back_success'>"+dialogue.getAttr("operatorName")+"已撤回一条消息</div>"))}else if("RECEIPT"==e)msgdb.set(i,"checkSend",1),t("div[name="+i+"] .msg_sending").hide(),t("div[name="+i+"] .msg_repeat").hide(),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db);else if("VS_QUEUE_INDEX"==e){var r=i;r&&(1==r.success?queue.options.success(r):1==r.inqueue?queue.options.always(r):0==r.errorCode?queue.options.fail(r):0==r.server?queue.options.fail(r):1==r.inqueue?queue.options.always(i):queue.options.leave(r))}},connect:function(e){dialogue.islive()&&(e?(detectWeb.getIsInitiate()&&dialogue.showSysMsg(dialogue.options.msgList.reconnectSuc,!0),detectWeb.getIsInitiate()&&(dialogue.toolFun(!0),detectWeb.checkedSuccess())):detectWeb.getIsInitiate()||(dialogue.toolFun(!1),dialogue.showSysMsg(dialogue.options.msgList.reconnectFail,!0),detectWeb.checkedFail()))},confirmSend:function(e){setTimeout(function(){var a=msgdb.get(e);a&&0==a.checkSend&&t("div[name="+e+"] .msg_sending").show()},600),setTimeout(function(){var a=msgdb.get(e);a&&0==a.checkSend&&(t("div[name="+e+"] .msg_sending").hide(),t("div[name="+e+"] .msg_repeat").show(),msgdb.set(e,"checkSend",2),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db))},3e3)},leaveCover:function(){uccPcEvent.leaveCover()},open:function(){uccPcEvent.openCover()}}),t("#message").delegate(".msg_repeat","click",function(){var e=t(this).parents(".contentMessage");if(e.attr("name")&&dialogue.islive()){e.attr("name");e.prev().hasClass("dialogue-date")&&e.prev().hide(),e.hide();var a=changeFaceFun.imgToIco(e.find("span.content").html());dialogue.sendMessage(a)}}),webSocket.init().done(function(){return e.resolve()}),e.promise()},initSatifaction:function(){satisfaction=t.satisfaction({dialogue:dialogue,companyPk:ucc.companyPk,langPk:ucc.defaultLangPk,chatId:ucc.chatID,generate:function(){t(".satisfactionView .fr").each(function(e,a){var i=t(this);i.append('<input type="radio" name="fr"><span>'+i.attr("data-name")+"</span>")}),t(".satisfactionView .sr").each(function(e,a){var i=t(this);i.append('<input type="checkbox" class="srCheck" name="'+i.data("parent")+'"><span>'+i.attr("data-name")+"</span>")}),t(".satisfactionView .sr").hide(),t('.satisfactionView .fr input[name = "fr"]').click(function(){var e=t(this);t(".satisfactionView .sr ").hide(),t('.satisfactionView .sr input[name ="'+e.parents(".fr").data("pk")+'"]').parents(".sr").css("display","inline")}),t(".satisfactionView .fr input[type=radio]").first().click(),t(".satisfactionView .title .cross img,.satisfactionView .bottom .cancel").on("click",function(){satisfaction.cancel()}),t(".satisfactionView .bottom .submit").on("click",function(){var e=t('.satisfactionView .fr input[name = "fr"]').filter(":checked");if(0==e.length)return void Alert.show("请选择满意度评价！");var a=e.parents(".fr").data("pk"),i="";if(satisfaction.getElementByParent(a).length>0){if(0==t('.satisfactionView .sr input[name = "'+a+'"]').filter(":checked").length)return void Alert.show("请选择原因！");t('.satisfactionView .sr input[name = "'+a+'"]').filter(":checked").each(function(){var e=t(this);i+=e.parents(".sr").data("pk")+","})}datas.set("hasSatisfaction",!0),satisfaction.submit({satisfactionPk:e.parents(".fr").data("parent"),optionPk:e.parents(".fr").data("pk"),satisfactionMemo:t(".satisfactionView .mome textarea").val()?t(".satisfactionView .mome textarea").val():"",nextSatisfactionPk:i})})}}),satisfaction.init(),satisfaction.hasSat||t(".tool6").hide()},initFunc:function(){visitorRobot=t.visitorRobot({companyPk:ucc.companyPk,visitorId:storage.get("visitor").visitorId,chatId:ucc.chatID,newAfter:function(e){var a="";for(var i in e)if(!isNaN(Number(i))){var n=e[i];a+='<div class="item" data-question="'+n+'">'+n+"</div>"}a='<div class="visitorRobot">'+a+"</div>",t(".visitorRobot").remove(),t(".dialogue-area").append(a),t(".visitorRobot .item").on("click",function(){robot.click=!0,t(".dialogue-area-write").html(t(this).data("question")),t(".send").click(),t(".visitorRobot").hide()})},after:function(e){var a="";for(var i in e)if(!isNaN(Number(i))){var n=e[i],o=n.question,s=n.highlightedArray;s=s.insertSort(function(e,t){return e<t});for(var c=0,r=s.length;c<r;c++)o=o.substring(0,s[c],r)+"<div class='red'>"+o.charAt(s[c])+"</div>"+o.substring(s[c]+1,o.length);a+='<div class="item" data-question="'+n.question+'">'+o+"</div>"}a='<div class="visitorRobot">'+a+"</div>",t(".visitorRobot").remove(),t(".dialogue-area").append(a),t(".visitorRobot .item").on("click",function(){robot.click=!0,t(".dialogue-area-write").html(t(this).data("question")),t(".send").click(),t(".visitorRobot").hide()})},init:function(){var a=null;t(".dialogue-area-write").on("focus",function(){visitorRobot.ok&&(a&&(e.clearInterval(a),a=null),a=setInterval(function(){visitorRobot.ok?visitorRobot.check(t(".dialogue-area-write").text()):a&&(e.clearInterval(a),a=null)},1e3))}).on("blur",function(){a&&(e.clearInterval(a),a=null)})},hide:function(){t(".visitorRobot").remove()}}),visitorRobot.init(),detectWeb=t.detectWeb({period:30,after:function(){dialogue.end(6),t("#face_08").css("display","none"),t(".sendFile").hide()}}),TimeoutList=t.TimeoutList({msgdb:msgdb,ops:ucc.OperatorBasicSettings,startFun:function(){dialogue.islive()&&(TimeoutList.isVisitorHalfTimeout()&&(langTip.show(langTip.type.system,langTip.key.no_answer_hint),changeWindow&&changeWindow.change()),TimeoutList.isVisitorTimeout()&&langTip.show(langTip.type.system,langTip.key.no_answer_close),TimeoutList.isClientBusy()&&(langTip.show(langTip.type.system,langTip.key.cs_busy),changeWindow&&changeWindow.change()))}}),userDatas.options.chatID=ucc.chatID,userDatas.options.businessId="",userDatas.options.businessName="",queue=t.queueManager({companyPk:ucc.companyPk,chatID:ucc.chatID,langPk:ucc.defaultLangPk,message:JSON.stringify(userDatas.getJsonStr()),IpStr:JSON.stringify(userDatas.getIpStr()),success:function(e){msgdb.clear(),changeWindow.clear(),t(".service-info p:gt(1)").remove(),t("#sysmsg").html(""),datas.set("reconnectData",e),datas.set("opName",e.workgroupName),datas.set("_workGroupName",e.workgroupName),dialogue.setAttr("_workGroupName",e.workgroupName),dialogue.setAttr("remoteUrl",e.url);var a=e.workgroupName.split("-");dialogue.setAttr("operatorName",e.opShow?e.opShow:a[1]),datas.set("hasInQueue",!1);var i=robot.recored,n="";if(i.length>0)for(var o in i)dialogue.showMsg(i[o]),"visitor"==i[o].from?n+="<div class='robotmsg' data-time='"+i[o].date+"' data-from='"+i[o].from+"'  data-content='"+i[o].content+"'  >访客问:<div>"+i[o].content+"</div></div>":"robot"==i[o].from&&(n+="<div class='robotmsg' data-time='"+i[o].date+"' data-from='"+i[o].from+"'  data-content='"+i[o].content+"' >机器人答:<div>"+i[o].content+"</div></div>");return robot.recored=[],langTip.show("1","7"),langTip.show("1","9"),storage.set("canSendFile",!1),storage.set("oldService",e.workgroupName),changeWindow.setMsgObj(e),1==e.success?(dialogue.start(),storage.set("chatNum",Number(userDatas.getJsonStr().chatNum)+1),!0):(langTip.show(data.langType,data.langKey),!1)},fail:function(e){systemInfo.show(decodeURIComponent(decodeURIComponent(e.msg)).replace(/\+/g," ")),t("#liveMessageId").click(function(){leaveMessage.show()}),t("#continueId").click(function(){t.ajax({type:"POST",url:"./queue.do",dataType:"json",data:{method:"continueBusinessQueue",chatID:ucc.chatID,companyPk:ucc.companyPk,langPk:ucc.defaultLangPk,businessId:userDatas.getJsonStr().businessId},async:!1}).done(function(e){0==e.success?(systemInfo.show(e.msg),t("#bl").remove(),t("#liveMessageId").click(function(){leaveMessage.show()})):(queue.index=-1,systemInfo.show(e.msg),queue.isTimeOut=!1,queue.getInfo(userDatas.getJsonStr().businessId,1,!1))}).fail(function(e){systemInfo.show("网络异常，请确保网络正常后再重新连接！")})})},leave:function(e){systemInfo.show(e.msg),t("#bl").remove(),t("#liveMessageId").click(function(){leaveMessage.show()})},continueque:function(e){systemInfo.show(e.msg)},always:function(e){systemInfo.show(e.msg)}}),queue.reqStartQueue=function(e,a){datas.get("hasInQueue")||(datas.set("hasInQueue",!0),pageLoad.getDepartment().done(function(){if(bList=t.businessList({businessList:ucc.businessList,aDset:ucc.aDset}),bList.getItemOnline(e)){userDatas.options.businessId=e,userDatas.options.businessName=a,userDatas.options.storageOldService=storage.get("oldService");var i=userDatas.getJsonStr();i.isWs=webSocket.isWork,queue.options.message=JSON.stringify(i),queue.options.IpStr=JSON.stringify(userDatas.getIpStr()),storage.set("businessId",e),storage.set("businessName",a),t(".service-info p:gt(1)").remove(),t("#sysmsg").html(""),queue.start(e,a)}else datas.set("hasInQueue",!1),uccPcLogic.showBusinessList(bList.getParentPk(e)),t(".service-info a[data-pk='"+e+"']").click(),leaveMessage.show()}))},webSocket.connect(),dialogue=t.dialogue({webSocket:webSocket,TimeoutList:TimeoutList,timeStr:'<p class="dialogue-date">$1</p>',msgEle:"#message",visitorId:userDatas.getVisitorInfo().visitorId,historyEle:"#historyChat",textEle:".dialogue-area-write",storage:storage,browserId:ucc.browserId,changeFaceFun:changeFaceFun,limitReceiveTime:60,chatId:ucc.chatID,detectWeb:detectWeb,userDatas:userDatas,msgList:{reconnectSuc:"重连服务器成功！",reconnectFail:"网络异常，系统正尝试重连服务器！"},closeStrList:[["对话出现异常，对话结束.","對話出現異常，對話結束.","Dialogue is abnormal, the dialogue."],["对话结束，客服离开对话.","對話結束，客服離開對話。","End of the conversation, customer service left the conversation."],["对话超时，对话结束。","對話超時，對話結束。","Dialogue timeout, the end of the conversation.Dialogue timeout, the end of the conversation."],["您好，为了保证服务质量，我们已经结束了对话，期待再次为您服务。","對話關閉，客服結束對話","dialog closes, end customer dialogue."],["响应超时，对话结束。","響應超時，對話結束。","Response timeout, end of the conversation."],["您结束了对话。","您結束了對話。","You end the conversation."],["网络中断，如需继续对话，请<a class='reconnectID'>点击此处</a>重新发起对话","網絡斷開，對話結束。","Network disconnection,end of the conversation."],["客服网络中断，当前对话结束，如需继续对话，请<a  class='reconnectID'>点击此处</a>重新接入。","客服网络中断，当前对话结束，如需继续对话，请重新接入。","Customer's Network has bean interrupted ,end of the conversation."],["网络异常，当前对话结束，如需继续对话，<a  class='reconnectID'>请重新接入</a>。","客服网络中断，当前对话结束，如需继续对话，请重新接入。","Network has bean interrupted ,end of the conversation."]],showSysMsgFun:function(e,a){var i='<div style="margin:15px 20px"><span class="font">'+e+"</span></div>";t("#message").append(i),a||msgdb.add({type:"system",content:e}),uccPcEvent.scrollTop(),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db)},getReceivedFun:function(e){},msgReplace:function(e){var t='<div class="$1 contentMessage" name="$msgid"><p class="dialogue-pic"><img src="$2"></p><div class="dialogue-in-r"><p class="in-name">$name</p><div class="dialogue-in-c"><span class="$4"><img src="$3"></span><span class="content">$content</span>$msgResend</div></div></div><div class="clearboth"></div>',a={client:{$1:"dialogue-in",$2:baseUrl+"/style/css/images/service.png",$3:baseUrl+"/style/css/images/d-dot1.png",$4:"d-dot1"},visitor:{$1:"dialogue-me",$2:baseUrl+"/style/css/images/me.png",$3:baseUrl+"/style/css/images/d-dot2.png",$4:"d-dot2"},robot:{$1:"dialogue-in",$2:baseUrl+"/style/css/images/robot.png",$3:baseUrl+"/style/css/images/d-dot1.png",$4:"d-dot1"}};if(fontStyle.isShow()&&"visitor"==e){var i='<span style="font-size:'+fontStyle.get("fontSize")+";color:"+fontStyle.get("color")+";font-weight:"+fontStyle.get("fontWeight")+";font-style:"+fontStyle.get("fontStyle")+";text-decoration:"+fontStyle.get("textDecoration")+";line-height:"+fontStyle.get("lineHeight")+";font-family:"+fontStyle.get("fontFamily")+'">$content</span>';t=t.replace(/\$content/g,i)}var n=a[e];return t.replace(/\$1/g,n.$1).replace(/\$2/g,n.$2).replace(/\$3/g,n.$3).replace(/\$4/g,n.$4)},startChat:function(){visitorRobot.ok=!1,uccPcInit.initSatifaction(),storage.set("offChat",ucc.browserId),datas.set("canSend",!0),storage.set("browserId",ucc.browserId),t(".tool5").toggle(1==storage.get("canSendFile"));var e=ucc.advertisement.content.replace(/<[^<]+>/g,"");datas.get("adv")||2!=parseInt(ucc.advertisement.accessDisplay)&&1!=parseInt(ucc.advertisement.accessDisplay)||1!=ucc.advertisement.isVisable||"null"==ucc.advertisement.content||""==e||(uccPcEvent.showAdvertisement(),datas.set("adv",!0))},endChat:function(){datas.set("hasInQueue",!1),localHistory.saveCurrent(),uccPcEvent.closeChatSatisfaction(),t.ajax({type:"POST",url:"./echat.do",data:{method:"closeEchat",chatID:ucc.chatID,url:dialogue.getAttr("remoteUrl"),opname:dialogue.getAttr("operatroName")?dialogue.getAttr("operatroName"):""},success:function(e){},dataType:"json"}),dialogue.sendMessage(" ","foreknowledge")},endChatFun:function(){visitorRobot.ok=!0,storage.set("offChat",!0),changeWindow.stopCheck(),t(".tool2-c").hide(),t(".face-c").hide(),t("#face_08").css("display","none"),t(".sendFile").hide(),t(".reminder").hide()},msgFun:function(e){"visitor"!=e.from&&"client"!=e.from||TimeoutList.reset(),msgdb.add({date:e.date,msgId:e.msgid,type:e.from,content:e.content,saveIn:e.saveIn?e.saveIn:0,hasChecked:e.hasChecked}),changeWindow&&changeWindow.change(),visitorRobot&&visitorRobot.hide(),localHistory.setCurrent(msgdb.db),uccPcEvent.showAudio(),uccPcEvent.scrollTop()},sendMessageFun:function(e,t){datas.set("openSatisfactionAfterCloseChat",!0),TimeoutList.startALLTimeout()},closeTool:function(){t(".send").attr("disabled","disabled"),t(".dialogue-area-write").attr("contentEditable","false"),t(".dialogue-area-write").hide(),t("#face_08").hide(),t(".sendFile").hide(),t("#close").hide(),t(".ucc-logo-cancel").hide()},openTool:function(){t(".send").removeAttr("disabled"),t(".dialogue-area-write").attr("contentEditable","true"),t(".dialogue-area-write").show(),t(".dialogue-area-write").focus(),t("#face_08").show(),t("#close").show(),t(".ucc-logo-cancel").show(),t(".tool5").toggle(1==storage.get("canSendFile"))},confirmSend:function(e,a){"add"==a&&e?t(".contentMessage[name='']:last").attr("name",e):e&&t(".contentMessage[name="+e+"] ._msg").hide()},specialFun:function(e,a){if("openWin"==e)uccPcEvent.openWin(a);else if("200"==e)uccPcEvent.titleGlitter(),TimeoutList.startALLTimeout();else if("700"==e)if("pushsatisfaction"==a.code)satisfaction.show();else if("sendFile"==a.code){var i=JSON.parse(a.text);uccPcEvent.showFile(i.content)}else if("getinfo"==a.code)visitorInformation.show();else if("foreknowledge"==a.code){var n=t(".reminder").length;if(0!=n)"1"==JSON.parse(a.text).content?t(".reminder").show():t(".reminder").hide();else{var o='<div class= "reminder"><div class="rp"></div>对方正在输入...</div>';t("body").append(o),t(".reminder").css({position:"absolute",bottom:"164px",left:"5px"})}}else"uploadfile"==a.code?dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(a.text).content,from:"client",status:0}):"audio"==a.code||("rqAccept"==a.code?(dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(a.text).content,from:"client",status:0}),clientAccept()):"ringOff"==a.code?(dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(a.text).content+"<img src='assets/right.png'/>",from:"client",status:0}),dialogue.sendMessage("ringOff","ringOff"),uccPcEvent.saveTopicType("audio")):"rqCancel"==a.code||"rqReject"==a.code||"rqTimeOut"==a.code?dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(a.text).content,from:"client",status:0}):"micIsOccupy"==a.code&&dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(a.text).content,from:"client",status:0}));else if("900"==e)t("#face_08").css("display","none"),t(".sendFile").hide();else if("901"==e)t("#face_08").css("display","none"),t(".sendFile").hide();else if("110"==e)t("#face_08").css("display","none"),t(".sendFile").hide();else if("111"==e)TimeoutList.startALLTimeout();else if("112"==e);else if("113"==e){var s=JSON.parse(a);msgdb.set(s.messageId,"isRevoke",!0),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db);var c=t("div[name="+s.messageId+"]");"none"!=c.css("display")&&(c.hide(),c.prev().hasClass("dialogue-date")&&c.prev().hide(),c.after("<div class='msg_back_success'>"+dialogue.getAttr("operatorName")+"已撤回一条消息</div>"))}else if("114"==e)var s=JSON.parse(a);else"902"==e&&(langTip.show(langTip.type.system,langTip.key.no_answer_close),t("#face_08").css("display","none"),t(".sendFile").hide())}}),leaveMessage=t.leaveMessage(_defineProperty({Alert:Alert,warn:".warning",messageDisplay:ucc.messageDisplay,messageContent:ucc.messageContent,messageTypeList:ucc.messageTypeList,companyPk:ucc.companyPk,generate:function(e){t(".leaveMessageView .title .cross img,.leaveMessageView .bottom .cancel").on("click",function(){leaveMessage.cancel()}),t(".leaveMessageView .col").each(function(a,i){var n=t(this),o=1==n.data("require")?'<div class="ico">*</div>':"";if(n.append('<span class="name">'+n.data("name")+o+'</span><span class="input"></span><span class="warning"></span>'),"combox"==n.data("type")){var s="<select >";for(var c in e)e[c].name&&(s+='<option value="'+e[c].pk+'" >'+e[c].name+"</option>");s+="</select>",n.find(".input").append(s),n.find(".input select option").first().attr("selected","selected")}else"textarea"==n.data("type")?n.find(".input").append('<textarea  placeholder="'+n.data("markedwords")+'" ></textarea>'):n.find(".input").append('<input type="text" placeholder="'+n.data("markedwords")+'" >')}),t(".leaveMessageView .board [data-displayname='content'] textarea").val(""),t(".leaveMessageView .board .input,.leaveMessageView .board .textarea").focusin(function(e){leaveMessage.check(t(this).parents(".col").data("displayname"))}),t(".leaveMessageView .bottom .submit").on("click",function(){leaveMessage.submit({messageTypePk:t(".leaveMessageView .board [data-displayname='messageTypePk']").length>0?t(".leaveMessageView .board [data-displayname='messageTypePk'] select").val():"",name:t(".leaveMessageView .board [data-displayname='name']").length>0?t(".leaveMessageView .board [data-displayname='name'] input").val():"",telephone:t(".leaveMessageView .board [data-displayname='telephone']").length>0?t(".leaveMessageView .board [data-displayname='telephone'] input").val():"",email:t(".leaveMessageView .board [data-displayname='email']").length>0?t(".leaveMessageView .board [data-displayname='email'] input").val():"",title:t(".leaveMessageView .board [data-displayname='title']").length>0?t(".leaveMessageView .board [data-displayname='title'] input").val():"",content:t(".leaveMessageView .board [data-displayname='content']").length>0?t(".leaveMessageView .board [data-displayname='content'] textarea").val():"",company:t(".leaveMessageView .board [data-displayname='company']").length>0?t(".leaveMessageView .board [data-displayname='company'] input").val():"",brand:t(".leaveMessageView .board [data-displayname='brand']").length>0?t(".leaveMessageView .board [data-displayname='brand'] input").val():""})}),t("input, textarea").placeholder()},reset:function(e){t(".leaveMessageView .board [data-displayname='messageTypePk'] select").val(),t(".leaveMessageView .board [data-displayname='name'] input").val(""),t(".leaveMessageView .board [data-displayname='telephone'] input").val(""),t(".leaveMessageView .board [data-displayname='email'] input").val(""),t(".leaveMessageView .board [data-displayname='title'] input").val(""),t(".leaveMessageView .board [data-displayname='content'] textarea").val(""),t(".leaveMessageView .board [data-displayname='company'] input").val(""),t(".leaveMessageView .board [data-displayname='brand'] input").val("")}},"warn",function(e,t){e.find(".warning").html(t)})),leaveMessage.init(),visitorInformation=t.visitorInformation({storage:storage,Alert:Alert,storageVisitor:"visitor",generate:function(e){t(".visitorInformationView .body .col").each(function(e,a){var i=t(this),n=1==i.data("require")?'<div class="ico">*</div>':"";if(i.append('<span class="name">'+i.data("name")+n+'</span><span class="input"></span><span class="warning"></span>'),"radio"==i.data("type")){var o='<span class="radio"><input type="radio" name="sex" value="1" >男</span><span class="radio"><input type="radio" name="sex" value="2" checked="checked">女</span>';i.find(".input").append(o)}else i.find(".input").append('<input type="text" placeholder="'+(i.data("placeholder")?i.data("placeholder"):"")+'" value="'+(i.data("markedwords")?i.data("markedwords"):"")+'" >')}),t(".visitorInformationView .title .cross img,.visitorInformationView .bottom .cancel").on("click",function(){visitorInformation.cancel()}),t(".visitorInformationView .board .input").focus(function(e){visitorInformation.check()}),t(".visitorInformationView .bottom .submit").on("click",function(e){visitorInformation.submit({visitorName:t(".visitorInformationView .board [data-displayname='visitorName'] input").val(),sex:t(".visitorInformationView input[name=sex]").filter(":checked").val(),realName:t(".visitorInformationView .board [data-displayname='realName'] input").val(),mobile:t(".visitorInformationView .board [data-displayname='phone'] input").val(),email:t(".visitorInformationView .board [data-displayname='email'] input").val(),QQ:t(".visitorInformationView .board [data-displayname='QQ'] input").val(),address:t(".visitorInformationView .board [data-displayname='address'] input").val(),company:t(".visitorInformationView .board [data-displayname='company'] input").val()})})},warn:function(e,t){e.find(".warning").html(t)},submitFun:function(e){dialogue.sendMessage(JSON.stringify(userDatas.getJsonStr()),"getinfo"),dialogue.showSysMsg("信息提交成功！")},cancelFun:function(){dialogue.islive()&&dialogue.sendMessage("访客取消了访客信息收集","cancelVisitorInformation")}}),robot=t.robot({visitorId:storage.get("visitor").visitorId,visitorName:storage.get("visitor").visitorName,dialogue:dialogue,robotSetting:ucc.BasicSetting.robotSetting,companyPk:ucc.companyPk,chatId:ucc.chatID,ecselfList:ucc.ecselfList,langPk:ucc.defaultLangPk,changeToNormal:function(e){t.ajax({type:"POST",url:"./echatManager.do",data:{method:"keepTenQA",chatId:ucc.chatID},dataType:"json"}).done(function(e){}),t("#message>*").not("#historyChat,#moreHistory,.service-info").remove(),langTip.show("1","1"),langTip.show("1","2"),visitorRobot.ok=!1,robot.isUse=!1,workTime.iswork(),0==workTime.type?uccPcLogic.loadScheme():workTime.show(),dialogue.toolFun(!1),t(".accept").css("display","block"),t("#autoReply").css("display","none"),t(".centerTime").remove()}}),t("body").delegate(".robotResp","click",function(){robot.isUse&&!dialogue.islive()&&robot.options.changeToNormal()}),t("body").delegate(".robotSuggsetion","click",function(){robot.isUse&&!dialogue.islive()&&robot.check(t(this).text())}),robot.check(),robot.isUse?(t(".send").removeAttr("disabled"),t(".dialogue-area-write").attr("contentEditable","true"),t(".dialogue-area-write").show()):visitorRobot.ok=!1,langTip=t.langTip({companyPk:ucc.companyPk,defaultLangPk:ucc.defaultLangPk,langMap:ucc.langMap,show:function(e){var a=new RegExp("&quot;","g");switch(e.langKey){case 1:t("#sysmsg").html(e.content?e.content.replace(a,'"'):"");break;case 2:t("#welcome").html(e.content?e.content.replace("留言",'<a href="javascript:void(0)" class="dialogue-a fanke-liuyan" >留言</a>').replace(a,'"'):"");break;case 3:dialogue.showMsg({content:e.content?e.content.replace(a,'"'):"",from:"robot",saveIn:1});break;case 4:dialogue.showMsg({content:e.content?e.content.replace(a,'"'):"",from:"robot",saveIn:1});break;case 5:dialogue.showMsg({content:e.content?e.content.replace(a,'"'):"",from:"robot",saveIn:1}),dialogue.end(4);break;case 6:dialogue.showMsg({content:e.content?e.content.replace(a,'"'):"",from:"robot",saveIn:1});break;case 7:
dialogue.showSysMsg(e.content?e.content.replace(a,'"'):"",!0);break;case 9:dialogue.showMsg({content:e.content?e.content.replace(a,'"'):"",from:"robot",saveIn:1});break;default:dialogue.showSysMsg(e.content?e.content.replace(a,'"'):e.conntent.replace(a,'"'),!0)}}}),changeWindow&&clearInterval(changeWindow.browserInterval),changeWindow=t.changeWindow({msgdb:msgdb,open:!0,storage:storage,chatId:ucc.chatID,browserId:ucc.browserId,TimeoutList:TimeoutList,dialogue:dialogue,data:datas,start:function(){t("#message").html(""),t(".leaveMessage").remove(),visitorInformation.hide(),ucc.BasicSetting.need=0},end:function(){t(".visitorRobot").hide(),t(".reminder").hide(),uccPcEvent.leaveCover()}}),changeWindow.init()},initHistory:function(){History=t.history({show:!1,visitorId:userDatas.getVisitorInfo().visitorId,companyPk:ucc.companyPk,dialogue:dialogue,generation:function(){dialogue.islive()||(History.getLeaveChat(),History.showLeaveChat(),History.check(),History.getSum()>0&&(t("#moreHistory").length<=0&&t("#message").prepend("<div style='cursor:pointer;text-align:center;color:#666;margin-top:10px;' id='moreHistory'>点击查看历史记录</div>"),t("#moreHistory").on("click",function(){var e="historyOperator.do?method=moreHistoryDialogue&visitorId="+userDatas.getVisitorInfo().visitorId+"&companyPk="+ucc.companyPk,t="消息记录";tab.add(t,t,e)})))},checkFun:function(){}}),History.init()},initLocalHistory:function(){History=t.history({show:!1,visitorId:userDatas.getVisitorInfo().visitorId,companyPk:ucc.companyPk,dialogue:dialogue,generation:function(){dialogue.islive()||(History.getLeaveChat(),History.showLeaveChat(),localHistory.history.length>0&&(t("#moreHistory").length<=0&&t("#message").prepend("<div style='cursor:pointer;text-align:center;color:#666;margin-top:10px;' id='moreHistory'>点击查看历史记录</div>"),t("#moreHistory").on("click",function(){var e="historyOperator.do?method=moreHistoryDialogue&visitorId="+userDatas.getVisitorInfo().visitorId+"&companyPk="+ucc.companyPk,t="消息记录";tab.add(t,t,e)})))},checkFun:function(){}}),History.init()}},t.uccPcInit=function(e){var t=new i(e);return t}}(window,jQuery);
"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t,i){String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};var n=function(e){this.defaults={period:30,after:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={isInitiate:!1,isReconnection:!1,checkeTimeout:null,msgs:[],period:0,getIsInitiate:function(){return this.isInitiate},getIsReconnection:function(){return this.isReconnection},getMsgs:function(e){return this.msgs.length>e?this.msgs.slice(this.msgs.length-e,this.msgs.length):this.msgs},check:function(){this.period--,this.period<=0&&(this.options.after(),clearInterval(this.checkeTimeout),this.checkeTimeout=null,this.isInitiate=!1,this.period=this.options.period)},checkedSuccess:function(){clearInterval(this.checkeTimeout),this.checkeTimeout=null,this.period=this.options.period,this.isInitiate=!1},setInitiate:function(e){this.isInitiate=e},setIsReconnection:function(e){this.isReconnection=e},checkedFail:function(){var e=this;e.checkeTimeout=setInterval(function(){e.check()},1e3),this.isInitiate=!0},msgPush:function(e,t){this.msgs.push('{"'+e+'":"'+t+'"}')}},t.detectWeb=function(e){var t=new n(e);return t.period=t.options.period,t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={BasicSetting:{},ExtraSetting:{},workStr:"温馨提示：尊敬的客户，我们的服务时间是【$1】<br>如果有重要的事情，请点击<a href='javascript:void(0)' class='dialogue-a fanke-liuyan'>在线留言</a><br>给您带来的不便，敬请谅解.",holidayStr:"温馨提示：尊敬的客户，我们的节假日时间是【$1】<br>如果有重要的事情，请点击<a href='javascript:void(0)' class='dialogue-a fanke-liuyan'>在线留言</a><br>给您带来的不便，敬请谅解.",show:function(e){}},this.options=t.extend({},this.defaults,e)};n.prototype={timeZone:"",type:0,init:function(){var e=this,t=this.options.BasicSetting,i=this.options.ExtraSetting;if(t&&1==t.open){var n=t.startTime.split(":"),o=t.endTime.split(":");if(n.length<2||o.length<2)return!1;var a=new Date,s=new Date,r=new Date;a.setHours(n[0]),a.setMinutes(n[1]),a.setSeconds("00"),s.setHours(o[0]),s.setMinutes(o[1]),s.setSeconds("00");for(var c,l,d=r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1,u=r.getDate()<10?"0"+r.getDate():r.getDate(),m=r.getFullYear()+"-"+d+"-"+u,p="",f=t.week,h=r.getDay(),g=f.split(","),v=!1,y=0;y<=g.length;y++)switch(g[y]){case"0":p+="星期日&nbsp";break;case"1":p+="星期一&nbsp";break;case"2":p+="星期二&nbsp";break;case"3":p+="星期三&nbsp";break;case"4":p+="星期四&nbsp";break;case"5":p+="星期五&nbsp";break;case"6":p+="星期六&nbsp"}if(13==f.length&&(p=""),f.indexOf(h)>=0){if(r.getTime()>s.getTime()||r.getTime()<a.getTime())return e.type=1,e.timeZone=p+t.startTime+"-"+t.endTime,!1;for(var y=0;y<i.length;y++)if(1==i[y].exceType&&i[y].exceStartTime<=m&&i[y].exceEndTime>=m){c=i[y].exceStartTime,l=i[y].exceEndTime,v=!0;break}if(v)return e.type=2,e.timeZone=c+"-"+l,!1}else if("null"!=f){for(var y=0;y<i.length;y++)if(0==i[y].exceType&&i[y].exceStartTime<=m&&i[y].exceEndTime>=m){c=i[y].exceStartTime,l=i[y].exceEndTime,v=!0;break}if(!v)return e.type=1,e.timeZone=p+t.startTime+"-"+t.endTime,!1}}},iswork:function(){var e=this;e.type=0;var t=e.options.BasicSetting,i=e.options.ExtraSetting;if(t&&1==t.open){var n=t.startTime.split(":"),o=t.endTime.split(":");if(2!=n.length||2!=o.length)return!1;var a=new Date,s=new Date,r=new Date(nowtime);a.setHours(n[0]),a.setMinutes(n[1]),a.setSeconds("00"),s.setHours(o[0]),s.setMinutes(o[1]),s.setSeconds("00");for(var c,l,d=r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1,u=r.getDate()<10?"0"+r.getDate():r.getDate(),m=r.getFullYear()+"-"+d+"-"+u,p="",f=t.week,h=r.getDay(),g=f.split(","),v=!1,y=0;y<=g.length;y++)switch(g[y]){case"0":p+="星期日&nbsp";break;case"1":p+="星期一&nbsp";break;case"2":p+="星期二&nbsp";break;case"3":p+="星期三&nbsp";break;case"4":p+="星期四&nbsp";break;case"5":p+="星期五&nbsp";break;case"6":p+="星期六&nbsp"}if(13==f.length&&(p=""),f.indexOf(h)>=0){if(r.getTime()>s.getTime()||r.getTime()<a.getTime())return e.type=1,e.timeZone=p+t.startTime+"-"+t.endTime,!1;for(var y=0;y<i.length;y++)if(1==i[y].exceType&&i[y].exceStartTime<=m&&i[y].exceEndTime>=m){c=i[y].exceStartTime,l=i[y].exceEndTime,v=!0;break}if(v)return e.type=2,e.timeZone=c+"-"+l,!1}else if("null"!=f){for(var y=0;y<i.length;y++)if(0==i[y].exceType&&i[y].exceStartTime<=m&&i[y].exceEndTime>=m){c=i[y].exceStartTime,l=i[y].exceEndTime,v=!0;break}if(!v)return e.type=1,e.timeZone=p+t.startTime+"-"+t.endTime,!1}}},getMsg:function(){return 1==this.type?this.options.workStr.replace(/\$1/g,this.timeZone):2==this.type&&this.options.holidayStr.replace(/\$1/g,this.timeZone)},show:function(){var e=this.getMsg();this.options.show(e)}},t.workTime=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={businessList:[],aDset:[],root:"-1"},this.options=t.extend({},this.defaults,e)};n.prototype={num:1,basePk:-1,init:function(){var e=this.options.aDset;if(e){this.options.businessList;"0"!=e.joinUpType&&e.joinUpType&&("1"==e.joinUpType||"2"==e.joinUpType),this.reset("-1")}},reset:function(e){for(var t=this,i=this.options.businessList,n=!1,o=0;o<i.length;o++)if(i[o].parentPk==e){var a=t.getList(i[o].pk);if(0==a.length)i[o].operators.length>0&&(n=!0);else{var s=t.reset(i[o].pk);0==s?i[o].operators=[]:1==s&&(n=!0)}}return n},hasList:function(e){for(var t=[],i=this.options.businessList,n=0;n<i.length;n++)i[n].parentPk==e&&(i[n].operators.length>0?t.push({item:i[n],type:"online"}):t.push({item:i[n],type:"offline"}));return t},getList:function(e){for(var t=(this.num,[]),i=this.options.businessList,n=0;n<i.length;n++)i[n].parentPk==e&&(i[n].operators.length>0?(t.push({num:this.num,item:i[n],type:"online"}),this.num++):(t.push({num:this.num,item:i[n],type:"offline"}),this.num++));return t},getAllLength:function(){var e=this.options.businessList;return{listLength:e.length,operatorLength:e.length>0?e[0].operators.length:0,firstItem:e.length>0?e[0]:null}},getParentPk:function(e){for(var t=this.options.businessList,i=0;i<t.length;i++)if(t[i].pk==e)return t[i].parentPk;return null},setSelect:function(e,t){this.select={pk:e,name:t}},getSelect:function(){return this.select},generate:function(e){var t=this.getList(e),i=(this.getParentPk(e),!1);return e==-1&&0==t.length?{access:!0,online:!1}:e==this.basePk&&1==t.length?(this.basePk=t[0].item.pk,this.getList(t[0].item.pk).length>0?this.generate(t[0].item.pk):t[0].item.operators.length>0?{access:!0,online:!0,pk:t[0].item.pk,name:t[0].item.name}:{access:!0,online:!1,pk:t[0].item.pk,name:t[0].item.name}):(this.basePk==e&&(i=!0),{access:!1,list:t,root:i})},getItemOnline:function(e){for(var t=this.options.businessList,i=!1,n=0;n<t.length;n++)t[n].pk==e&&t[n].operators.length>0&&(i=!0);return i}},t.businessList=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=0,o=0,a=function(e){this.defaults={picStr:"<img id='showpic' src='$1'/>",bgColor:"rgba(0,0,0,0.5)"},this.options=t.extend({},this.defaults,e)};a.prototype={init:function(){var e=this;e.getScreenRatio(),t(".showPicture").length>0||(t("body").append('<div class="showPicture"></div>'),t(".showPicture").css({position:"fixed",top:"0",bottom:"0",left:"0",right:"0",background:e.options.bgColor,display:"none",zIndex:"1001"}))},showPic:function(e){var i=this;i.init(),t(".showPicture").html("").append(this.options.picStr.replace(/\$1/g,e)),t(".showPicture").show();var o=document.getElementById("showpic");o.complete?(n=t(".showPicture img").width()/t(".showPicture img").height(),i.getShowPic()):o.onload=function(){n=t(".showPicture img").width()/t(".showPicture img").height(),i.getShowPic()},t(".showPicture").unbind().on("click",function(e){t(".showPicture").hide()})},getShowPic:function(){o&&n&&(o>n?t(".showPicture img").height()>=t(e).height()?t(".showPicture img").css({width:"auto",height:"98%",padding:" 1% 0",display:"block",margin:"0 auto",position:"initial",top:"0"}):t(".showPicture img").css({display:"block",margin:"0 auto",position:"relative",top:(t(e).height()-t(".showPicture img").height())/2+"px"}):t(".showPicture img").width()>=t(e).width()?(t(".showPicture img").css({display:"initial",width:"98%",padding:"0 1%",height:"auto",position:"fixed",top:"50%"}),t(".showPicture img").css({marginTop:-t(".showPicture img").height()/2})):(t(".showPicture img").css({display:"initial",left:"50%",position:"fixed",top:"50%",padding:"1% 1%"}),t(".showPicture img").css({marginTop:-t(".showPicture img").height()/2,marginLeft:-t(".showPicture img").width()/2})))},getScreenRatio:function(){o=t(e).width()/t(e).height()}},t.showBigImg=function(e){var t=new a(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={msgdb:null,clientEndtime:480,clientBusytime:240,visitorEndTime:240,visitorHalfTime:120,ops:{},startFun:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={diaList:new Object,timeout:null,hasVisitorHalfTimeout:!1,hasVisitorTimeout:!1,hasClientBusy:!1,hasClientEnd:!1,init:function(){this.setTime()},setTime:function(){var e=this.options.ops;this.options.clientEndtime=e.customerFroVisitors?e.customerFroVisitors:this.options.clientEndtime,this.options.clientBusytime=e.customerBusy?e.customerBusy:this.options.clientBusytime,this.options.visitorEndTime=e.customerFroVisitors?e.customerFroVisitors:this.options.visitorEndTime,this.options.visitorHalfTime=this.options.visitorEndTime<=2*this.options.visitorHalfTime?this.options.visitorEndTime/2:this.options.visitorEndTime-this.options.visitorHalfTime},startALLTimeout:function(){var e=this;clearInterval(this.timeout),this.timeout=setInterval(function(){e.options.startFun()},1e3)},endChat:function(){this.hasVisitorHalfTimeout=!0,this.hasVisitorTimeout=!0,this.hasClientBusy=!0,this.hasClientEnd=!0},reset:function(){this.hasVisitorHalfTimeout=!1,this.hasVisitorTimeout=!1,this.hasClientBusy=!1,this.hasClientEnd=!1},removeDiaList:function(e){delete this.diaList[e]},diaListLast:function(){var e,t=this.options.msgdb;for(var i in t.db)t.db[i]&&"robot"!=t.db[i].type&&"system"!=t.db[i].type&&!t.db[i].isRevoke&&(e&&("visitor"==t.db[i].type&&"visitor"==t.db[e].type||"client"==t.db[i].type&&"client"==t.db[e].type)||(e=i));return e},isVisitorHalfTimeout:function(){var e=this.options.msgdb,t=this,i=e.db[t.diaListLast()];if(!t.hasVisitorHalfTimeout&&i&&"client"==i.type){var n=(new Date).getTime();if(n-i.time>=1e3*t.options.visitorHalfTime&&!i.hasChecked)return e.db[t.diaListLast()].hasChecked=!0,t.hasVisitorHalfTimeout=!0,!0}return!1},isVisitorTimeout:function(){var e=this.options.msgdb,t=this,i=e.db[t.diaListLast()];if(!t.hasVisitorTimeout&&i&&"client"==i.type){var n=(new Date).getTime();if(n-i.time>=1e3*t.options.visitorEndTime)return t.hasVisitorTimeout=!0,!0}return!1},isClientBusy:function(){var e=this.options.msgdb,t=this,i=this.options.ops,n=e.db[t.diaListLast()];if(0==i.customerBusy)return!1;if(!t.hasClientBusy&&n&&"visitor"==n.type){var o=(new Date).getTime();if(o-n.time>=1e3*t.options.clientBusytime&&!n.hasChecked)return e.db[t.diaListLast()].hasChecked=!0,t.hasClientBusy=!0,!0}return!1},isClientEnd:function(){var e=this.options.msgdb,t=this,i=e.db[t.diaListLast()],n=(new Date).getTime();return!!(n-i.time>=1e3*t.options.clientEndtime&&!t.hasClientEnd&&i.hasChecked)&&(e.db[t.diaListLast()].hasChecked=!0,t.hasClientEnd=!0,!0)}},t.TimeoutList=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'},o=[['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face01.png" data-name="/::)" id="/::)">',"/::)","/::\\)"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face02.png" id="/::P" data-name="/::P">',"/::P","/::P"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face03.png" id="/::$" data-name="/::$">',"/::$","/::\\$"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face04.png" id="/::D" data-name="/::D">',"/::D","/::D"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face05.png" id="/::-|" data-name="/::-|">',"/::-|","/::\\-\\|"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face06.png" id="/::+" data-name="/::+">',"/::+","/::\\+"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face07.png" id="/:,@-D"  data-name="/:,@-D">',"/:,@-D","/:,@\\-D"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face08.png" id="/::>" data-name="/::>">',"/::>","/::\\>"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face09.png" id="/:,@f" data-name="/:,@f">',"/:,@f","/:,@f"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face10.png" id="/:?" data-name="/:?">',"/:?","/:\\?"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face11.png" id="/:bye" data-name="/:bye">',"/:bye","/:bye"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face12.png" id="/:handclap" data-name="/:handclap">',"/:handclap","/:handclap"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face13.png" id="/::*" data-name="/::*">',"/::*","/::\\*"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face14.png" id="/:strong" data-name="/:strong">',"/:strong","/:strong"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face15.png" id="/:P-(" data-name="/:P-(">',"/:P-(","/:P\\-\\("],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face16.png" id="/:rose" data-name="/:rose">',"/:rose","/:rose"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face17.png" id="/:share" data-name="/:share">',"/:share","/:share"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face18.png" id="/:ok" data-name="/:ok">',"/:ok","/:ok"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face19.png" id="/:sun"  data-name="/:sun">',"/:sun","/:sun"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face20.png" id="/:heart" data-name="/:heart">',"/:heart","/:heart"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face21.png" id="/:hug" data-name="/:hug">',"/:hug","/:hug"]],a=function(e){this.defaults={imgIco:[],after:function(){}},this.options=t.extend({},this.defaults,e)};a.prototype={init:function(){this.options.imgIco=o,this.options.after()},getItems:function(){return o},imgToIco:function(e){var i=e;if(!i||"string"!=typeof e)return i;i=i.replace(/&(lt|gt|amp|quot);/gi,function(e,t){return n[t]});var a=t("<div>"+e+"</div>");for(var s in o)a.find("img[data-name='"+o[s][1]+"']").each(function(e){t(this).replaceWith(o[s][1])});return i=a.html()},icoToImg:function(e){var t=e;if(!t||"string"!=typeof e)return t;t=t.replace(/&(lt|gt|amp|quot);/gi,function(e,t){return n[t]});for(var a in o)t.indexOf(o[a][1])!=-1&&(o[a][2]==i||(t=t.replace(new RegExp(o[a][2],"gm"),o[a][0])));return t}},t.changeFace=function(e){var t=new a(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n,o=function(e){this.defaults={companyPk:""},this.options=t.extend({},this.defaults,e)};o.prototype={init:function(){n=e.localStorage?e.localStorage:e.Storage,this.setVersion()},setVersion:function(){var e=this,t=e.get("version"),i=e.get("jsonStr"),o=e.get("visitor"),a=e.get("localHis");t&&"8.0.1"==t||(n.clear(),i&&e.set("jsonStr",i),o&&e.set("visitor",o),a&&e.set("localHis",a),e.set("version","8.0.1"))},get:function(e){var i=null;"version"!=e&&(e="c"+this.options.companyPk+"-"+e),n?(i=n[e],i&&(i=decodeURIComponent(n[e]))):t.cookie&&(i=decodeURIComponent(t.cookie(e)));try{i=JSON.parse(i)}catch(o){}return i},set:function(e,i){"version"!=e&&(e="c"+this.options.companyPk+"-"+e),n?("object"==("undefined"==typeof i?"undefined":_typeof(i))&&(i=JSON.stringify(i)),n[e]=encodeURIComponent(i)):t.cookie&&t.cookie(e,encodeURIComponent(i))},clear:function(e){"version"!=e&&(e="c"+this.options.companyPk+"-"+e),n&&n.removeItem(e)}},t.storage=function(e){var t=new o(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={vocabulary:{}},this.options=t.extend({},this.defaults,e)};n.prototype={get:function(e){var t=e,i=this.options.vocabulary;if(i&&i.content&&1==i.isVisable)for(var n=i.content.split(":"),o=0;o<n.length;o++)if(n[o])for(var a=0;a<=t.length;a++)t=t.replace(n[o],"*");return t}},t.sensitive=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={bgColor:"rgba(0,0,0,0.3)",time:2},this.options=t.extend({},this.defaults,e)};n.prototype={isUse:!1,init:function(){var e=this;t("body").append("<div class='alert'><div class='col'></div></div>"),t(".alert").on("click",function(i){e.isUse=!1,t(".alert").hide()})},show:function(e,i){var n=this;0==n.isUse&&(n.isUse=!0,i&&"error"==i&&t(".alert .col").addClass("error"),t(".alert .col").html(e),t(".alert").show(),t(".alert .col").css({marginLeft:-t(".alert .col").width()/2-20,marginTop:-t(".alert .col").height()-10}),setTimeout(function(){n.isUse=!1,t(".alert").hide(),t(".alert .col").removeClass("error")},1e3*n.options.time))}},t.Alert=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(window,$,undefined){var mobile_type_arr=["ipad","ipod","iphone","ios","ios","android","backerry","webos","symbian","windows phone","phone","blackberry"],mobile_pc_browser_json={micromessenger:"微信浏览器",ucbrowser:"UC浏览器",qqbrowser:"QQ浏览器",opera:"Opera浏览器",baidubrowser:"百度浏览器",firefox:"火狐浏览器",maxthon:"傲游浏览器",xiaomi:"小米手机浏览器",chrome:"Chrome浏览器",android:"android内置浏览器",iphone:"iphone内置浏览器",ipod:"opod内置浏览器",ipad:"ipad内置浏览器"},pc_browser_json={qqbrowser:"QQ浏览器",opera:"Opera浏览器",maxthon:"傲游浏览器",tencenttraveler:"TT浏览器",theworld:"天天浏览器",lbbrowser:"猎豹浏览器",chrome:"Chrome浏览器",firefox:"Firefox浏览器",msie:"IE浏览器",safari:"Safari浏览器",metasr:"搜狗浏览器"},DATAS=function(e){this.defaults={param:null,storage:null,storageVisitor:"visitor",storageIpStr:"ipStr",storageChatNum:"chatNum",companyPk:"",aDset:null,chatID:"",businessId:"",businessName:"",storageOldService:"",opShow:""},this.options=$.extend({},this.defaults,e)};DATAS.prototype={hasGetJson:!1,hasGetVisitor:!1,hasIpStr:!1,getJsonStr:function(){var e=this,t={};e.hasGetJson&&(e.options.param.mn="");var i=this.getVisitorInfo(),n=this.options.aDset,o=this.getIpStr();if(e.options.param&&e.options.param.mn){var a=JSON.parse(decodeURIComponent(e.options.param.mn));t={companyPk:e.options.companyPk,visitorId:i.visitorId,visitorName:i.visitorName,businessId:e.options.businessId,businessName:e.options.businessName,chatID:e.options.chatID,browsingNum:a.browsingNum,fromPage:a.fromPage?a.fromPage:document.referrer.replace(/[&]/g,"%26")?document.referrer.replace(/[&]/g,"%26"):"",title:"",ip:o.cip,ipName:o.cname,usersource:n?n.scheme_Name:"",opShow:e.options.opShow,oldService:e.options.storageOldService,keyword:a.keyword,searchEngine:a.searchEngine,lastTime:Number(a.lastTime)?a.lastTime:"Invalid Date"==new Date(a.lastTime)?"":new Date(a.lastTime),firstTime:Number(a.firstTime)?a.firstTime:"Invalid Date"==new Date(a.firstTime)?"":new Date(a.firstTime),chatNum:e.getChatNum(),operatingSystem:e.getOperatingSystem(),visitor:i,commodity:{shopImgUrl:"",shopName:"",shopNum:"",shopPrice:"",shopUrl:""}}}else{var s=e.options.storage.get("jsonStr");t={visitorId:i.visitorId,companyPk:e.options.companyPk,visitorName:i.visitorName,businessId:e.options.businessId,businessName:e.options.businessName,chatID:e.options.chatID,browsingNum:s&&s.browsingNum?s.browsingNum:"",fromPage:s&&s.fromPage?s.fromPage:document.referrer.replace(/[&]/g,"%26")?document.referrer.replace(/[&]/g,"%26"):"",title:s&&s.title?s.title:"",usersource:n?n.scheme_Name:"",opShow:e.options.opShow,oldService:e.options.storageOldService,ip:o.cip,ipName:o.cname,keyword:s&&s.keyword?s.keyword:"",searchEngine:s&&s.searchEngine?s.searchEngine:"",lastTime:s&&s.lastTime?s.lastTime:"",firstTime:s&&s.firstTime?s.firstTime:"",chatNum:e.getChatNum(),operatingSystem:e.getOperatingSystem(),visitor:i,commodity:{shopImgUrl:"",shopName:"",shopNum:"",shopPrice:"",shopUrl:""}}}if(e.options.param.pageInfo&&e.options.param.isuse&&"true"==e.options.param.isuse){var r=decodeURIComponent(e.options.param.pageInfo),c=r.split("|"),l="",d="";1==c.length?(d=c[0].trim(),"null"==d&&(d="")):c.length>=2&&(d=c[0].trim(),l=c[1].trim(),"null"==d&&(d=""),"null"==l&&(l="")),t.title=encodeURIComponent(d),t.fromPage=encodeURIComponent(l)}else t.title="",t.fromPage="";if(e.options.param.defineParamsJson){var u=decodeURIComponent(e.options.param.defineParamsJson);t.defineParamsJson=u?u:""}return e.hasGetJson=!0,e.options.storage.set("jsonStr",t),t},getChatNum:function(){return this.options.storage.get(this.options.storageChatNum)?this.options.storage.get(this.options.storageChatNum):0},getOperatingSystem:function(){var e=this.options.param,t="pc",i=navigator.userAgent.toLowerCase(),n=/(iPhone|iPod|Android|ios|iOS|iPad|Backerry|WebOS|Symbian|Windows Phone|Phone|BlackBerry)/i;null!=i.match(n)&&(t="mb"),e&&e.qr&&(t="ma");var o=window.screen.width+"×"+window.screen.height,a=navigator.systemLanguage?navigator.systemLanguage:navigator.language?navigator.language:"",s={sysInfo:t,browserName:this.getUserAgent().browser_name,browser:this.getUserAgent().browser_type,operatorSystem:this.getUserAgent().terminal_system,sysResolution:o,language:a};return s},getUserAgent:function(){var e={},t=navigator.userAgent.toLowerCase(),i=/(iPhone|iPod|Android|ios|iOS|iPad|Backerry|WebOS|Symbian|Windows Phone|Phone|BlackBerry)/i;if(null!=t.match(i)){e.terminal_Type="移动终端";for(var n=0;n<mobile_type_arr.length;n++)if(t.indexOf(mobile_type_arr[n])>-1){e.terminal_system=mobile_type_arr[n];break}null!=e.terminal_system&&""!=e.terminal_system||(e.terminal_system="未知");for(var n in mobile_pc_browser_json)if(t.indexOf(n)>-1){e.browser_type=mobile_pc_browser_json[n],e.browser_name=n;break}null!=e.browser_type&&""!=e.browser_type||(e.browser_type="未知",e.browser_name="未知")}else{e.terminal_Type="PC终端";var o="未知",a="Win32"==navigator.platform||"Windows"==navigator.platform,s="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;s&&(o="Mac");var r="X11"==navigator.platform&&!a&&!s;r&&(o="Unix");var c=String(navigator.platform).indexOf("Linux")>-1;if(c&&(o="Linux"),a){var l=t.indexOf("windows nt 5.0")>-1||t.indexOf("windows 2000")>-1;l&&(o="Win2000");var d=t.indexOf("windows nt 5.1")>-1||t.indexOf("windows xp")>-1;d&&(o="WinXP");var u=t.indexOf("windows nt 5.2")>-1||t.indexOf("windows 2003")>-1;u&&(o="Win2003");var m=t.indexOf("windows nt 6.0")>-1||t.indexOf("windows vista")>-1;m&&(o="WinVista");var p=t.indexOf("windows nt 6.1")>-1||t.indexOf("windows 7")>-1;p&&(o="Win7");var f=t.indexOf("windows nt 6.2")>-1||t.indexOf("windows 7")>-1;f&&(o="Win8");var h=t.indexOf("windows nt 10.0")>-1||t.indexOf("windows 10")>-1;h&&(o="Win10");var g=t.indexOf("Edge")>-1;g&&(o="WinEdge")}e.terminal_system=o;for(var n in pc_browser_json)if(t.indexOf(n)>-1){e.browser_type=pc_browser_json[n],e.browser_name=n;break}if(null==e.browser_type||""==e.browser_type){var v="Win10"==o,g="WinEdge"==o;v||g?(e.browser_type=pc_browser_json.msie,e.browser_name="msie"):(e.browser_type="未知",e.browser_name="未知")}}return e.flash_version=this.getFlash_version(),e},getFlash_version:function getFlash_version(){var f="-",n=navigator;if(n.plugins&&n.plugins.length){for(var ii=0;ii<n.plugins.length;ii++)if(n.plugins[ii].name.indexOf("Shockwave Flash")!=-1){f=n.plugins[ii].description.split("Shockwave Flash ")[1];break}}else if(window.ActiveXObject)for(var ii=10;ii>=2;ii--)try{var fl=eval("new ActiveXObject('ShockwaveFlash.ShockwaveFlash."+ii+"');");if(fl){f=ii+".0";break}}catch(e){}return f},getIpStr:function(){var e=this;if(e.hasGetIpStr)return e.options.storage.get(e.options.storageIpStr);var t=null;return e.options.storage.get(e.options.storageIpStr)?t=e.options.storage.get(e.options.storageIpStr):$.ajax({url:"./echatManager.do?method=getIp",dataType:"jsonp",async:!1,complete:function(){t="object"==("undefined"==typeof returnCitySN?"undefined":_typeof(returnCitySN))?returnCitySN:{cip:"0.0.0.0",cid:"0",cname:"未知地区"}}}),e.hasGetIpStr=!0,e.options.storage.set(e.options.storageIpStr,t),t},getVisitorInfo:function(){var e=this,t={};if(!e.hasGetVisitor&&e.options.param&&e.options.param.mn){var i=JSON.parse(decodeURIComponent(e.options.param.mn));if(t.visitorId=i.visitorId,t.visitorName=i.visitorName,e.options.param.hjUserData){var n=decodeURIComponent(e.options.param.hjUserData),o=n.split("|");try{t.sex=o[1],t.realName=o[0],t.phone=o[2],t.mobile=o[3],t.email=o[4],t.QQ=o[8],t.MSN=o[7],t.address=o[5],t.company=o[6],t.visitorId=o[9],t.visitorName=o[0]}catch(a){}}}else if(!e.hasGetVisitor&&e.options.param&&e.options.param.memberPk)t.visitorId=e.options.param.memberPk;else if(e.options.storage.get(e.options.storageVisitor)){var s=e.options.storage.get(e.options.storageVisitor);t.visitorId=s.visitorId?s.visitorId:"",""==t.visitorId&&$.ajax({type:"POST",url:"echatManager.do?method=generationVisitorsID",async:!1,data:{companyPk:e.options.companyPk},dataType:"json"}).done(function(e){e&&(t.visitorId=e.visitorId)}),t.company=s.company?s.company:"",t.visitorName=s.visitorName?s.visitorName:"访客"+Number(t.visitorId.substring(1)),t.sex=isNaN(Number(s.sex))?0:s.sex,t.degree=s.degree?s.degree:"",t.realName=s.realName?s.realName:"",t.phone=s.phone?s.phone:"",t.mobile=s.mobile?s.mobile:"",t.email=s.email?s.email:"",t.QQ=s.QQ?s.QQ:"",t.MSN=s.MSN?s.MSN:"",t.address=s.address?s.address:"",t.extension=s.extension?s.extension:"",t.memberId=s.memberId?s.memberId:""}t.visitorId||$.ajax(_defineProperty({type:"POST",url:"echatManager.do?method=generationVisitorsID",async:!1,data:{companyPk:e.options.companyPk},dataType:"json"},"async",!1)).done(function(e){e&&(t.visitorId=e.visitorId,t.visitorName="访客"+e.showId)});e.updateVisitorName(t,t.visitorId);return e.hasGetVisitor=!0,e.options.storage.set(e.options.storageVisitor,t),t},updateVisitorName:function(e,t){var i=this;return i.hasGetVisitor||$.ajax({type:"POST",url:"echatManager.do?method=getVisitorsName",async:!1,data:{visitorId:t},dataType:"json"}).done(function(t){t.success&&(e.company=t.company||e.company||"",e.visitorName=t.name||e.visitorName||"",e.sex=isNaN(Number(t.sex))?e.sex?e.sex:0:t.sex,e.degree=t.degree||e.degree||"",e.realName=t.realName||e.realName||"",e.phone=t.phone||e.phone||"",e.mobile=t.mobile||e.mobile||"",e.email=t.email||e.email||"",e.QQ=t.QQ||e.QQ||"",e.MSN=t.MSN||e.MSN||"",e.address=t.address||e.address||"",e.extension=t.extension||e.extension||"",e.memberId=t.memberId||e.memberId||"")}),e}},$.userDatas=function(e){var t=new DATAS(e);return t}}(window,jQuery),function(e,t,i){var n=function(){var e=location.href,t=e.indexOf("?")!==-1?e.split("?").pop():"",i={};return t.replace(/(\w+)(?:=([^&]*))?/g,function(e,t,n){i[t]=n}),i};t.getParameter=n}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={open:!1,msgdb:null,storage:null,chatId:"",browserId:"",dialogue:null,data:null,TimeoutList:null,start:function(){},end:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={isChanged:!1,browserInterval:null,db:{},change:function(){var e=this.options.storage,t=this.options.chatId,i=e.get("currentChat")?e.get("currentChat"):[];i=this.options.msgdb.getAll(),e.get("currentChatId")&&this.options.chatId==e.get("currentChatId")||(i=[]),e.set("currentChatId",t),e.set("currentChat",i)},clear:function(){this.options.chatId},check:function(){var e=this.options.chatId,t=this.options.storage;return!(!t.get("currentChat")||!t.get("currentChatId")||t.get("currentChatId")!=e)&&t.get("currentChat")},setMsgObj:function(e){var t=(this.options.chatId,this.options.storage);t.set("msgObjCurrentChat",e)},getMsgObj:function(){var e=this.options.storage;return e.get("msgObjCurrentChat")},init:function(){var e=this.options.storage,t=this;t.db=this.options.storage.get("currentChat"),t.options.open&&(e.get("browserId")&&e.get("currentChatId")&&t.options.chatId==e.get("currentChatId")&&e.set("browserId",t.options.browserId),t.startcheck(),"over"!=t.browserInterval&&(t.browserInterval=setInterval(function(){t.startcheck()},1e3)))},startcheck:function(){var e=this,t=this.options.storage,i=this.options.dialogue,n=this.options.data,o=this.options.msgdb;if(t.get("browserId")&&e.options.chatId==t.get("currentChatId"))if(1!=t.get("offChat")&&e.options.browserId!=t.get("browserId"))1==i.islive()&&(i.end(),e.options.end());else if(e.options.browserId==t.get("browserId")&&e.getMsgObj()&&0==i.islive()){e.isChanged=!0,t.set("browserId",e.options.browserId),t.set("offChat",e.options.browserId),o.clear(),e.options.start();var a=e.getMsgObj();if(n.set("reconnectData",a),i.setAttr("remoteUrl",a.url),i.setAttr("_workGroupName",a.workgroupName),i.setAttr("operatorName",a.opShow),n.set("opName",a.workgroupName),n.set("_workGroupName",a.workgroupName),i.start(),e.db){var s=e.db;for(var r in s){var c=s[r];!c||"visitor"!=c.type&&"client"!=c.type&&"robot"!=c.type?c&&"system"==c.type&&c.content&&i.showSysMsg(c.content):c.content&&!c.isRevoke&&0==c.status&&2!=c.checkSend&&i.showMsg({msgid:c.msgId,date:c.time,content:c.content,from:c.type,status:c.status,hasChecked:c.hasChecked}),o.id=parseInt(r)+1}e.options.TimeoutList.startALLTimeout(),o.db=e.db}}},stopCheck:function(){var e=this;clearInterval(e.browserInterval),e.browserInterval="over",e.clear()}},t.changeWindow=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={chatID:"",companyPk:"",langPk:0,message:{},IpStr:"",always:function(e){},success:function(e){},fail:function(e){},leave:function(){},continueque:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={businessId:"",businessName:"",isTimeOut:!1,index:1,start:function(e,i){var n=this;t.ajax({type:"POST",url:"./queue.do",dataType:"json",data:{method:"inQueue",chatID:n.options.chatID,companyPk:n.options.companyPk,langPk:n.options.langPk,message:n.options.message,IpStr:n.options.IpStr}}).done(function(t){t&&(1==t.success?n.options.success(t):1==t.inqueue?(n.getInfo(e,0,!1),n.options.always(t)):0==t.errorCode?n.getInfo(e,0,!1):0==t.server?n.options.fail(t):n.options.leave(t)),n.failTime=0}).fail(function(){n.failTime=n.failTime||(new Date).getTime(),(new Date).getTime()-n.failTime>9e3?n.options.fail({msg:"网络问题,您已离开"}):setTimeout(function(){n.start(e,i)},1e3)})},getInfo:function(e,i,n){var o=this;t.ajax({type:"POST",url:"./queue.do",dataType:"json",data:{method:"getBusinessQueue",chatID:o.options.chatID,companyPk:o.options.companyPk,langPk:o.options.langPk,message:o.options.message,businessId:e,index:i,isouttimes:n}}).done(function(t){t&&(1==t.success?(o.index!=t.index&&(o.index=t.index,o.options.always(t)),t.workgroupName?t.url&&o.options.success(t):1==t.inqueue?setTimeout(function(){o.options.always(t),o.getInfo(e,t.index,!1)},1e3):setTimeout(function(){o.getInfo(e,t.index,!1)},2e3)):0==t.over?(o.isTimeOut=!0,o.options.fail(t),setTimeout(function(){1==o.isTimeOut&&o.getInfo(e,t.index,!0)},1e4)):0==t.server?o.options.fail(t):o.options.fail(t)),o.failTime=0}).fail(function(){o.failTime=o.failTime||(new Date).getTime(),(new Date).getTime()-o.failTime>9e3?o.options.fail({msg:"网络问题,您已离开"}):setTimeout(function(){o.getInfo(e,o.index,!1)},1e3)})},continueque:function(e,i,n){var o=this;t.ajax({type:"POST",url:"./queue.do",dataType:"json",data:{method:"continueBusinessQueue",chatID:o.options.chatID,companyPk:e,langPk:i,businessId:n
}}).done(function(e){o.istimeout=!1,o.getInfo(n,0,!1),o.options.continueque(e)})}},t.queueManager=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={chatId:"",storage:null},this.options=t.extend({},this.defaults,e)};n.prototype={list:{},get:function(e){var t=this.options.storage;if(t){var i=t.get("data");return i?i[e]:i}var n=this.options.chatId+e;return this.list[n]?this.list[n]:null},set:function(e,t){var i=this.options.storage;if(i){var n=i.get("data");n=n?n:{},n[e]=t,i.set("data",n)}else{var o=this.options.chatId+e;this.list[o]=t}}},t.db=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={webSocket:null,timeStr:'<p class="dialogue-date">$1</p>',resendStr:'<div class="msg_sending" ><img src="style/images/sending.gif"></div>',callbackStr:'<div class="msg_repeat" ><img style="vertical-align: bottom;margin-right:5px;" src="style/images/repeat.png"></div>',msgEle:"#message",visitorId:"",historyEle:"#historyChat",textEle:".dialogue-area-write",storage:null,browserId:"",limitReceiveTime:60,changeFaceFun:null,chatId:"",detectWeb:null,userDatas:null,msgList:{reconnectSuc:"重连服务器成功！",reconnectFail:"网络异常，系统正尝试重连服务器！"},closeStrList:[["对话出现异常，对话结束.","對話出現異常，對話結束.","Dialogue is abnormal, the dialogue."],["对话结束，客服离开对话.","對話結束，客服離開對話。","End of the conversation, customer service left the conversation."],["对话超时，对话结束。","對話超時，對話結束。","Dialogue timeout, the end of the conversation.Dialogue timeout, the end of the conversation."],["您好，为了保证服务质量，我们已经结束了对话，期待再次为您服务。","對話關閉，客服結束對話","dialog closes, end customer dialogue."],["响应超时，对话结束。","響應超時，對話結束。","Response timeout, end of the conversation."],["您结束了对话。","您結束了對話。","You end the conversation."],["网络中断，如需继续对话，请<a href='javascript:void(0)' class='reconnectID'>点击此处</a>重新发起对话","網絡斷開，對話結束。","Network disconnection,end of the conversation."],["客服网络中断，当前对话结束，如需继续对话，请<a href='javascript:void(0)' onclick=''  class='reconnectID'>点击此处</a>重新接入。","客服网络中断，当前对话结束，如需继续对话，请重新接入。","Customer's Network has bean interrupted ,end of the conversation."],["网络异常，当前对话结束，如需继续对话，<a href='javascript:void(0)' onclick=''  class='reconnectID'>请重新接入</a>。","客服网络中断，当前对话结束，如需继续对话，请重新接入。","Network has bean interrupted ,end of the conversation."]],showSysMsgFun:function(e){},getReceivedFun:function(e){},msgReplace:function(e){},startChat:function(){},endChat:function(){},sendMessageFun:function(e,t){},msgFun:function(e){},closeTool:function(){},openTool:function(){},confirmSend:function(e,t){},specialFun:function(e,t){},endChatFun:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={msgPair:{},diaCount:0,isSpeech:!1,lastSend:"",diaList:new Object,readMessageTimeout:null,readMessageInterval:null,prevTextInterval:null,time:(new Date).getTime(),attr:{langType:0,islive:!1,operatorName:"",remoteUrl:"",_workGroupName:""},getAttr:function(e){return"undefined"!=typeof e?this.attr[e]:""},setAttr:function(e,t){this.attr[e]=t},islive:function(){return this.getAttr("islive")},showMsg:function(e){var i=e.msgid?e.msgid:"",n=e.date?e.date:"",o=e.content,a=e.from?e.from:"client",s=e.status?e.status:0,r=this.options.userDatas,c=this.options.msgReplace(a),l="client"==a,d=l?this.getAttr("operatorName"):"robot"==a?this.islive()?this.getAttr("operatorName"):"客服":r.getJsonStr().visitorName?r.getJsonStr().visitorName:"访客";if(o&&"null"!=o){var u=/^((ht|f)tps?):\/\/[\w\-]+(\.[\w\-]+)+([\w\-\.,@?^=%&:\/~\+#]*[\w\-\@?^=%&\/~\+#])?$/,m=t("<div>"+o+"</div>").text();if("client"==a&&u.test(m)&&o.indexOf("audio")<0){var p="<a href="+m+" target='_blank'>"+m+"</a>";o=p,this.options.specialFun("openWin",p)}if(o=this.messageChange(o),o=this.options.changeFaceFun.imgToIco(o),o=this.options.changeFaceFun.icoToImg(o),c=c.replace(/\$name/g,d).replace(/\$content/g,o).replace(/\$msgid/g,i).replace(/\$msgResend/g,"visitor"==a?this.options.resendStr+this.options.callbackStr:""),0!=s&&s){n||(n=(new Date).getTime());var f=this.options.timeStr.replace(/\$1/g,new Date(n).Format("yyyy-MM-dd hh:mm:ss"));t(this.options.historyEle).prepend(c),t(this.options.historyEle).prepend(f)}else{n||(n=(new Date).getTime());var f=this.options.timeStr.replace(/\$1/g,new Date(n).Format("hh:mm:ss"));t(this.options.msgEle).append(f),t(this.options.msgEle).append(c)}this.options.msgFun(e)}},messageChange:function(e){var i=e;try{if(i=JSON.parse(t("<div>"+e+"</div>").text()),"news"==i.msgType){var n={title:i.articles[0].title,summary:i.articles[0].summary,url:i.articles[0].url,img:i.articles[0].picUrl};i='<div class="message_news" data-url="'+n.url+'" ><div class="title">'+n.title+'</div><div class="content"><div class="summary">'+n.summary+'</div><div class="img"><img src="'+n.img+'"/></div></div></div>'}else if("IDCard"==i.type){var n={title:i.nickname,summary:i.summaryStr,url:i.detailURL,img:i.headURL?i.headURL:"./bootstrapUI/any800/images/client.png"};i='<div class="message_news IDCard" data-url="'+n.url+'" ><div class="img"><img src="'+n.img+'"/></div><div class="content"><div class="title">'+n.title+'</div><div class="summary">'+n.summary+"</div></div></div>"}else if("knowledgeCard"==i.type){var n={title:i.title,summary:i.description,url:i.url,img:i.coverUrl?i.coverUrl:"./bootstrapUI/any800/images/client.png"};i='<div class="message_news knowledgeCard" data-url="'+n.url+'" ><div class="content"><div class="title">'+n.title+'</div><div class="summary">'+n.summary+'</div><div class="img"><img src="'+n.img+'"/></div></div></div>'}else i=e}catch(o){}return i},showSysMsg:function(e,t){e&&"undefined"!=e&&"null"!=e&&this.options.showSysMsgFun(e,t)},start:function(){var t=this;t.setAttr("islive",!0),t.options.storage.set("browserId",t.options.browserId),t.options.webSocket&&t.options.webSocket.isWork?t.prevTextInterval=e.setInterval(function(){t.preVstText()},2e3):(t.startReadMessageTimeout(),clearInterval(t.prevTextInterval),clearInterval(t.readMessageInterval),t.readMessageInterval=e.setInterval(function(){(new Date).getTime()-t.time>1e4&&t.startReadMessageTimeout()},1e4),t.prevTextInterval=e.setInterval(function(){t.preVstText()},2e3)),t.toolFun(!0),t.options.startChat()},startReadMessageTimeout:function(){var t=this;t.time=(new Date).getTime(),t.readMessageTimeout&&clearTimeout(t.readMessageTimeout),t.readMessageTimeout=e.setTimeout(function(){t.readMessage()},1e3)},end:function(e){var t=this;t.islive()&&(t.setAttr("islive",!1),t.options.webSocket&&t.options.webSocket.isWork||(t.readMessageTimeout&&clearTimeout(t.readMessageTimeout),t.readMessageTimeout=null,clearInterval(t.readMessageInterval),t.readMessageInterval=null,clearInterval(t.prevTextInterval),t.prevTextInterval=null),t.toolFun(!1),"number"==typeof e&&(t.options.storage.set("browserId",""),t.showSysMsg(this.options.closeStrList[e][t.getAttr("langType")],!0),t.options.endChat()),t.options.endChatFun())},readMessage:function(){var e=this,i=e.options.detectWeb;e.getAttr("remoteUrl")&&t.ajax({type:"POST",url:"./echat.do",dataType:"json",async:!1,cache:!1,data:{method:"readMessage",chatID:e.options.chatId,url:e.getAttr("remoteUrl")}}).done(function(t){e.startReadMessageTimeout();try{i.getIsInitiate()&&e.showSysMsg(e.options.msgList.reconnectSuc),e.messageDeal(t),i.getIsInitiate()&&(e.toolFun(!0),i.checkedSuccess())}catch(n){}}).fail(function(t){e.startReadMessageTimeout(),i.getIsInitiate()||(e.toolFun(!1),e.showSysMsg(e.options.msgList.reconnectFail),i.checkedFail())})},messageDeal:function(e){var t=this,i=t.options.detectWeb;if(e&&e.root){if(0==e.root.length)return!1;for(var n=0;n<e.root.length;n++){var o=e.root[n].type.text;if("200"==o){if(e.root[n].from&&""!=e.root[n].date)if(e.root[n].langType>0&&e.root[n].langKey>0);else{var a=JSON.parse(e.root[n].text);t.addDiaList(a.messageId,(new Date).getTime(),a.content,0,"client"),"object"==_typeof(a.content)&&(a.content=JSON.stringify(a.content)),a.content=a.content.replace(/\n/gi,"<br>"),t.showMsg({msgid:a.messageId,date:(new Date).getTime(),content:a.content,from:"client",status:0}),t.options.specialFun("200",{msgid:a.messageId,content:a.content,time:(new Date).getTime()}),i.msgPush("customer",a.content)}}else if("700"==o)t.options.specialFun("700",e.root[n]);else if("900"==o)i.getIsInitiate()?t.end(6):t.end(2),t.options.specialFun("900","");else if("901"==o)t.end(3),t.options.specialFun("901","");else if("110"==o)t.end(7),t.options.specialFun("110","");else if("111"==o){if(t.toolFun(!0),t.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(e.root[n].text).content,from:"client",status:0,saveIn:1}),i.getIsReconnection()){var s="["+i.getMsgs(5).join(",")+"]";t.sendMessage(s,"offLineMessage")}t.options.specialFun("111",e.root[n])}else"112"==o?(t.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(e.root[n].text).content,from:"client",status:0}),t.end(0),t.options.specialFun("112",e.root[n])):"113"==o?t.options.specialFun("113",e.root[n].text):"114"==o?t.options.specialFun("114",e.root[n].text):"902"==o&&t.islive()&&(t.options.specialFun("902",e.root[n].text),t.end(2))}}},addDiaList:function(e,t,i,n,o){return e||(e="Other"+(new Date).getTime(),this.diaCount++),this.diaList[e]={time:t,from:o,content:i,status:n,isReceived:"client"==o?1:0,receivedTime:0},e},getReceived:function(){var e=this,i=this.diaList,n=[];for(var o in i)0==i[o].isReceived&&n.push(o);for(var a in n)isNaN(Number(a))||t.ajax({type:"post",url:"echat.do?method=getReceivedMID",async:!1,data:{messageId:e.msgPair[n[a]],workGroupName:this.getAttr("_workGroupName")},dataType:"json",success:function(t){e.options.getReceivedFun(n[a]),e.diaList[n[a]].isReceived=1,e.options.confirmSend(n[a]),t.success||(e.diaList[n[a]].receivedTime>=e.options.limitReceiveTime?e.diaList[n[a]].isReceived=2:e.diaList[n[a]].receivedTime++)}})},preVstText:function(){var e=(this.lastSend,t(this.options.textEle).text().replace(/\s+/g,""));this.lastSend!=e&&(this.lastSend=e,e?this.sendMessage(e,"foreknowledge"):this.sendMessage(" ","foreknowledge"))},sendMessage:function(e,i,n){var o=this,a={lt:"<",gt:">",amp:"&",quot:'"'};e=e.replace(/&(lt|gt|amp|quot);/gi,function(e,t){return a[t]}),"acceptRq"==i&&(this.isSpeech=!0),"offLineMessage"==i||"send_file"!=i||(i=""),e=e.replace(/<a/g,"<a target='_blank'");var s=o.addDiaList("",(new Date).getTime(),e,0,"visitor"),r=(new Date).getTime();return i||n||(o.showMsg({msgid:s,date:r,content:e,from:"visitor",status:0}),o.options.sendMessageFun(s,e)),o.options.webSocket&&o.options.webSocket.isWork&&!i?void o.options.webSocket.send({date:r,message:e,chatID:o.options.chatId}):void t.ajax({type:"POST",url:"./echat.do",dataType:"json",async:!1,data:{method:"sendMessage",chatID:o.options.chatId,message:e,code:i?i:"",url:o.getAttr("remoteUrl"),visitorId:o.options.visitorId}}).done(function(e){if(1==e.success){var t=e.messageId;"back"==e.message?o.options.confirmSend(t):o.options.confirmSend(t,"add"),o.msgPair[s]=t,o.callbackFun(s,t)}})},callbackFun:function(e,i){var n=this;setTimeout(function(){n.diaList[e].isReceived||t("[name="+e+"] .msg_").html(n.options.callbackStr)},6e4)},toolFun:function(e){e?this.options.openTool():this.options.closeTool()}},t.dialogue=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={detectWeb:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={beatInterval:null,beatTimeout:null,json:{},init:function(e){},startBeatTimeout:function(e){},end:function(){}},t.heartBeat=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={dialogue:null,companyPk:"",langPk:"",chatId:"",title:"满意度调查",top:"您对本次服务满意吗？",bottom:"<div class='bottom'><div class='cancel'>取消</div><div class='submit'>确定</div></div>",generate:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={hasSat:!1,init:function(){var e=this;t.ajax({type:"POST",url:"./echatManager.do",dataType:"json",async:!1,data:{method:"getSatisfaction",companyPk:e.options.companyPk,langPk:e.options.langPk,chatID:e.options.chatId}}).done(function(t){t&&(e.hasSat=!0,e.createView(t))})},check:function(e){},cancel:function(){this.options.dialogue.sendMessage("访客取消了满意度评价","cancelSatisfaction"),this.hide()},createView:function(e){t(".satisfactionView").length>0&&t(".satisfactionView").remove();var i="<div class='satisfactionView view'><div class='board'></div></div>",n="<div class='fr' data-pk='$1' data-parent='$2' data-name='$3'></div>",o="<div class='sr' data-pk='$1' data-parent='$2' data-name='$3'></div>";t("body").append(i);var a="<div class='title'>"+this.options.title+"<span class='cross'><img src='./style/css/images/shut.png'></span></div>";a+="<div class='body'><div class='top'>"+this.options.top+"</div>";for(var s=0,r=e.length;s<r;s++){var c=e[s];if(a+=n.replace(/\$1/g,c.pk).replace(/\$2/g,c.parentPk).replace(/\$3/g,c.name),c.children.length>0)for(var l=0,d=c.children.length;l<d;l++){var u=c.children[l];a+=o.replace(/\$1/g,u.pk).replace(/\$2/g,u.parentPk).replace(/\$3/g,u.name)}}a+="<div class='mome'><textarea placeholder='请输入详情'></textarea></div></div>",a+=this.options.bottom,t(".satisfactionView .board").html(a),this.hide(),this.options.generate()},getElement:function(e){return t(".satisfactionView .board [data-pk='"+e+"']")},getElementByParent:function(e){return t(".satisfactionView .board [data-parent='"+e+"']")},submit:function(e){var i=this,n=this.options.dialogue;t.ajax({type:"POST",url:"./echatManager.do",dataType:"json",data:{method:"saveSatisfaction",companyPk:i.options.companyPk,chatID:i.options.chatId,satisfactionPk:e.satisfactionPk,optionPk:e.optionPk,satisfactionMemo:e.satisfactionMemo,nextSatisfactionPk:e.nextSatisfactionPk,rndVar:(new Date).getTime()}}).done(function(){var t=i.getElement(e.optionPk).attr("data-name"),o="，原因为：",a="";if(e.nextSatisfactionPk){var s=e.nextSatisfactionPk.split(",");for(var r in s)s[r]&&i.getElement(s[r]).attr("data-name")&&(a+=i.getElement(s[r]).attr("data-name")+",")}a.lastIndexOf(",")==a.length-1&&(a=a.substring(0,a.length-1)),a&&(a=o+a);var c="访客给您的满意度评价是："+t+a;n.sendMessage(c,"",!0),n.showSysMsg("您给客服"+n.getAttr("operatorName")+"的评价："+t+a)}),this.hide()},show:function(){this.hasSat&&(t(".satisfactionView").show(),t(".satisfactionView .board").css({marginTop:"-220px"}),t(".satisfactionView textarea").focus().blur(),t(".satisfactionView input,.satisfactionView textarea").not(".hasplaceholder").placeholder())},hide:function(){t(".satisfactionView").hide()}},t.satisfaction=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){function n(e,t){return function(i,n){return t?~~(i[e]<n[e]):~~(i[e]>n[e])}}var o=function(e){this.defaults=_defineProperty({Alert:null,messageDisplay:[],messageContent:"",messageTypeList:[],warn:".warn",title:"请留言",bottom:"<div class='bottom'><div class='cancel'>取消</div><div class='submit'>确定</div></div>",generate:function(e){},reset:function(e){}},"warn",function(e,t){}),this.options=t.extend({},this.defaults,e)},a=function(e,t){for(var i=e,t=t||function(e,t){return t>e},n=1,o=i.length;n<o;n++){for(var a=i[n],s=n-1;s>=0&&t(i[s],a);)i[s+1]=i[s],s--;i[s+1]=a}return i};o.prototype={hasCreate:!1,init:function(){var e=this;e.options.messageDisplay.length>0&&(e.options.messageDisplay=a(e.options.messageDisplay,n("sort",!1)),e.createView(),e.hasCreate=!0)},check:function(e){var i=this;t(".leaveMessageView .col").removeClass("warn");var n=!0;return t(".leaveMessageView .col").each(function(o,a){var s=t(this);if(0!=n&&(!e||s.data("displayname")==e)){if("company"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"公司名称不能为空"),s.addClass("warn"),void(n=!1);if(s.find("input").val().length>30)return i.options.warn(s,"公司名称最大长度为30字符"),s.addClass("warn"),void(n=!1)}if("name"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"姓名不能为空"),s.addClass("warn"),void(n=!1);if(s.find("input").val().length>20)return i.options.warn(s,"姓名最大长度为20字符"),s.addClass("warn"),void(n=!1)}if("telephone"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"电话不能为空"),s.addClass("warn"),void(n=!1);if(""==s.find("input").val())return;var r=new RegExp(/^[1][0-9]{1}[0-9]{9}$/);if(!r.test(s.find("input").val()))return i.options.warn(s,"请填写正确的电话"),s.addClass("warn"),void(n=!1)}if("email"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"电子邮件不能为空"),s.addClass("warn"),void(n=!1);if(""==s.find("input").val())return;var c=new RegExp(/^[\-\._A-Za-z0-9]+@([_A-Za-z0-9\-]+\.)+[A-Za-z0-9]{2,3}$/);if(!c.test(s.find("input").val()))return i.options.warn(s,"请填写正确的电子邮件"),s.addClass("warn"),void(n=!1);if(s.find("input").val().length>50)return i.options.warn(s,"电子邮件最大长度为50字符"),s.addClass("warn"),void(n=!1)}if("title"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"主题不能为空"),s.addClass("warn"),void(n=!1);if(s.find("input").val().length>50)return i.options.warn(s,"主题最大长度为50字符"),s.addClass("warn"),void(n=!1)}if("content"==s.data("displayname")){if(1==s.data("require")&&""==s.find("textarea").val())return i.options.warn(s,"内容不能为空"),s.addClass("warn"),void(n=!1);if(s.find("textarea").val().length>1e3)return i.options.warn(s,"内容最大长度为1000字符"),s.addClass("warn"),void(n=!1)}}}),n},cancel:function(){this.hide()},createView:function(){var e=this;t(".leaveMessageView").length>0&&t(".leaveMessageView").remove();var i="<div class='leaveMessageView view'><div class='board'></div></div>";t("body").append(i);var n="<div class='title'>"+e.options.title+"<span class='cross'><img src='./style/css/images/shut.png'></span></div>";n+="<div class='body'>",e.options.messageContent&&(n+="<div class='top'>"+e.options.messageContent+"</div>");var o="<div class='col' data-type='$0' data-require='$1' data-name='$2' data-markedwords='$3' data-displayname='$4' ></div>";for(var a in e.options.messageDisplay){var s=e.options.messageDisplay[a];1==s.display&&"messageTypePk"==s.displayName&&(n+=o.replace(/\$0/g,s.judgeDisplay).replace(/\$1/g,s.required).replace(/\$2/g,s.name).replace(/\$3/g,s.markedWords).replace(/\$4/g,s.displayName))}for(var a in e.options.messageDisplay){var s=e.options.messageDisplay[a];1==s.display&&"messageTypePk"!=s.displayName&&(n+=o.replace(/\$0/g,s.judgeDisplay).replace(/\$1/g,s.required).replace(/\$2/g,s.name).replace(/\$3/g,s.markedWords).replace(/\$4/g,s.displayName))}n+="</div>",n+=this.options.bottom,t(".leaveMessageView .board").html(n),this.hide(),this.options.generate(e.options.messageTypeList)},submit:function(e){var i=this,n=i.options.Alert;if(!i.check())return!1;if(!e.messageTypePk)return i.options.warn(t(".leaveMessageView [data-displayname='messageTypePk']"),"请选择留言分类"),t(".leaveMessageView [data-displayname='messageTypePk']").addClass("warn"),void(can=!1);var o=e.content;try{o=encodeURIComponent(encodeURIComponent(o))}catch(a){}t.ajax({type:"POST",url:"./echatManager.do",dataType:"json",data:{method:"saveMessageBox",messageTypePk:e.messageTypePk,companyPk:i.options.companyPk,name:e.name,telephone:e.telephone,email:e.email,title:e.title,content:e.content,company:e.company,brand:e.brand,contentencode:o}}).done(function(e){1==e.success?(n.show(e.msg),i.reset(),i.hide()):n.show(e.msg)}),i.hide()},reset:function(e){this.options.reset},show:function(){this.hasCreate&&(t(".leaveMessageView").show(),t(".leaveMessageView .board").css({marginTop:-t(".leaveMessageView .board").height()/2}),t(".leaveMessageView input,.leaveMessageView textarea").not(".hasplaceholder").placeholder())},hide:function(){t(".leaveMessageView").hide()}},t.leaveMessage=function(e){var t=new o(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={storage:null,Alert:null,title:"请填写以下信息",storageVisitor:"visitor",bottom:"<div class='bottom'><div class='cancel'>取消</div><div class='submit'>确定</div></div>",generate:function(e){},warn:function(e,t){},submitFun:function(){},cancelFun:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={hasCreate:!1,visitor:{visitorId:"",company:"",visitorName:"",sex:"0",degree:"",realName:"",phone:"",mobile:"",email:"",QQ:"",MSN:"",address:"",extension:"",memberId:""},init:function(){var e=this,t=e.options.storage;t.get(e.options.storageVisitor)&&(e.visitor=t.get(e.options.storageVisitor)),e.createView(),e.hasCreate=!0},check:function(){var e=this;t(".visitorInformationView .col").removeClass("warn");var i=!0;return t(".visitorInformationView .col").each(function(n,o){var a=t(this);if(0!=i){if("visitorName"==a.data("displayname")){var s=new RegExp(/^[a-zA-Z0-9\u4e00-\u9fa5]+(\s[a-zA-Z0-9\u4e00-\u9fa5]+|)$/);if(1==a.data("require")&&""==a.find("input").val())return e.options.warn(a,"昵称不能为空"),a.addClass("warn"),void(i=!1);if(a.find("input").val().length>20)return e.options.warn(a,"昵称最大长度为20字符"),a.addClass("warn"),void(i=!1);if(!s.test(a.find("input").val()))return e.options.warn(a,"请输入中文、英文和数字！"),a.addClass("warn"),void(i=!1)}if("realName"==a.data("displayname")&&a.find("input").val().length>20)return e.options.warn(a,"姓名最大长度为20字符"),a.addClass("warn"),void(i=!1);if("phone"==a.data("displayname")){if(""==a.find("input").val())return;var r=new RegExp(/^[1][0-9]{1}[0-9]{9}$/);if(!r.test(a.find("input").val()))return e.options.warn(a,"请填写正确的手机号码"),a.addClass("warn"),void(i=!1)}if("phone"==a.data("displayname")){if(""==a.find("input").val())return;var r=new RegExp(/^[1][0-9]{1}[0-9]{9}$/);if(!r.test(a.find("input").val()))return e.options.warn(a,"请填写正确的手机号码"),a.addClass("warn"),void(i=!1)}if("QQ"==a.data("displayname")&&a.find("input").val().length>20)return e.options.warn(a,"QQ最大长度为20字符"),a.addClass("warn"),void(i=!1);if("email"==a.data("displayname")){if(""==a.find("input").val())return;var s=new RegExp(/^[\-\._A-Za-z0-9]+@([_A-Za-z0-9\-]+\.)+[A-Za-z0-9]{2,3}$/);if(!s.test(a.find("input").val()))return e.options.warn(a,"请填写正确的邮箱"),a.addClass("warn"),void(i=!1);if(a.find("input").val().length>50)return e.options.warn(a,"邮箱最大长度为50字符"),a.addClass("warn"),void(i=!1)}return"address"==a.data("displayname")&&a.find("input").val().length>50?(e.options.warn(a,"地址最大长度为50字符"),a.addClass("warn"),void(i=!1)):"company"==a.data("displayname")&&a.find("input").val().length>50?(e.options.warn(a,"公司名称最大长度为50字符"),a.addClass("warn"),void(i=!1)):void 0}}),i},cancel:function(){this.options.cancelFun(),this.hide()},createView:function(){var e=this;t(".visitorInformationView").length>0&&t(".visitorInformationView").remove();var i="<div class='visitorInformationView view'><div class='board'></div></div>";t("body").append(i);var n="<div class='title'>"+e.options.title+"<span class='cross'><img src='./style/css/images/shut.png'></span></div>";n+="<div class='body'>",n+="<div class='col' data-type='input' data-require='1' data-name='昵称' data-placeholder='请输入昵称' data-displayname='visitorName' ></div>",n+="<div class='col' data-type='radio' data-require='0' data-name='性别'  data-markedwords='"+(e.visitor.sex?e.visitor.sex:"")+"' data-displayname='sex' ></div>",n+="<div class='col' data-type='input' data-require='0' data-name='姓名' data-placeholder='请输入姓名' data-markedwords='"+(e.visitor.realName?e.visitor.realName:"")+"' data-displayname='realName' ></div>",n+="<div class='col' data-type='input' data-require='0' data-name='手机' data-placeholder='请输入手机号码' data-markedwords='"+(e.visitor.phone?e.visitor.phone:"")+"' data-displayname='phone' ></div>",n+="<div class='col' data-type='input' data-require='0' data-name='QQ' data-placeholder='请输入QQ号码' data-markedwords='"+(e.visitor.QQ?e.visitor.QQ:"")+"' data-displayname='QQ' ></div>",n+="<div class='col' data-type='input' data-require='0' data-name='邮箱' data-placeholder='请输入邮箱地址' data-markedwords='"+(e.visitor.email?e.visitor.email:"")+"' data-displayname='email' ></div>",n+="<div class='col' data-type='input' data-require='0' data-name='地址' data-placeholder='请输入地址' data-markedwords='"+(e.visitor.address?e.visitor.address:"")+"' data-displayname='address' ></div>",n+="<div class='col' data-type='input' data-require='0' data-name='公司' data-placeholder='请输入公司名称' data-markedwords='"+(e.visitor.company?e.visitor.company:"")+"' data-displayname='company' ></div>",n+="</div>",n+=this.options.bottom,t(".visitorInformationView .board").html(n),this.hide(),this.options.generate()},submit:function(e){var i=this,n=i.options.storage;if(i.check()){var o=n.get(i.options.storageVisitor);o=t.extend({},o,e),n.set(i.options.storageVisitor,o),i.visitor=o,n.set("isSave",0),i.options.submitFun(i.visitor),i.hide()}},show:function(){this.hasCreate&&(t(".visitorInformationView").show(),t(".visitorInformationView .board").css({marginTop:-t(".visitorInformationView .board").height()/2}))},hide:function(){t(".visitorInformationView").hide()}},t.visitorInformation=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={show:!0,visitorId:"",companyPk:"",leavePre:"离线消息:",maxDia:5,dialogue:null,generation:function(){},checkFun:function(e){}},this.options=t.extend({},this.defaults,e)};n.prototype={page:1,historyDias:[],leaveDias:[],over:!1,cur:1,num:0,more:!0,showHistoryDia:function(){if(0!=this.options.show){var e=this,t=this.options.dialogue;for(var i in e.historyDias)if(!isNaN(Number(i)))for(var n in e.historyDias[i].content.dia)if(!isNaN(Number(i))){var o=e.historyDias[i].content.dia[n];!o.hasShown&&o.num<e.cur*e.options.maxDia&&(e.historyDias[i].content.dia[n].hasShown=!0,t.showMsg({date:Number(new Date(o.time.replace(/-/g,"/")).getTime()),from:o.from,content:o.content,status:1}))}}},showLeaveChat:function(e){var t=this,i=this.options.dialogue;for(var n in t.leaveDias)isNaN(Number(n))||i.showMsg({from:t.leaveDias[n].from,content:t.leaveDias[n].content,status:1,date:t.leaveDias[n].date})},init:function(){this.options.generation()},check:function(e){this.getSum()<this.cur*this.options.maxDia+1&&!this.over?(this.getHistoryDialogue(),this.check()):(this.showHistoryDia(),this.cur++),this.more=!this.over||!(this.getSum()<this.cur*this.options.maxDia+1),this.options.checkFun()},changeToContent:function(e){for(var i=this,n=0,o=[],a=t("<div>"+e+"</div>").find(".sevice_chat,.me_chat,.robot_chat"),s=a.length-1;s>=0;s--)0==t(a[s]).find(".msg_back_success").length&&(o.push({from:"sevice_chat"==a[s].className?"client":"robot_chat"==a[s].className?"robot":"visitor",content:t(a[s]).find("content").html(),hasShown:!1,num:i.num,time:t(a[s]).find("time").html()}),i.num++,n++);return{sum:n,dia:o}},getSum:function(){var e=this,t=0;for(var i in e.historyDias)isNaN(Number(i))||(t+=e.historyDias[i].content.sum);return t},getHistoryDialogue:function(){var e=this;t.ajax({url:"./historyOperator.do",type:"POST",async:!1,dataType:"json",data:{method:"getHistoryDialogue",page:e.page,visitorId:e.options.visitorId,companyPk:e.options.companyPk}}).done(function(t){if(!t||0==t.length)return void(e.over=!0);for(var i in t)if(!isNaN(Number(i))){var n=e.changeToContent(t[i].content,t[i].from);e.historyDias.push({time:new Date(t[i].leaveTime.replace(/-/g,"/")).getTime(),content:n})}e.page++}).fail(function(){e.over=!0})},getLeaveChat:function(){var e=this;t.ajax({type:"post",async:!1,url:"historyOperator.do",dataType:"json",data:{method:"getLeaveChat",visitorId:e.options.visitorId}}).done(function(t){if(0!=t.length){t=t.reverse();for(var i in t)if(!isNaN(Number(i))){var n=t[i].content;if("string"!=typeof n)try{n=JSON.stringify(n)}catch(o){}n=dialogue.messageChange(n),e.leaveDias.push({content:e.options.leavePre+""+n,from:"client"})}}})}},t.history=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={visitorName:"",visitorId:"",ecselfList:null,langPk:"",dialogue:null,robotSetting:2,companyPk:"",chatId:"",ywList:"ff80808150db355d0150e12f11a90388",confidence:60,changeToNormal:function(e){}},this.options=t.extend({},this.defaults,e)};n.prototype={isUse:!0,choose:!1,ncRobotTime:0,nc:{number:2,answer:"我正在学习中",questions:"投诉".split(";")},recored:[],click:!1,check:function(e){var t=this,i=t.options.dialogue;if(2==t.options.robotSetting)return t.isUse=!1,!1;e&&(i.showMsg({date:(new Date).getTime(),content:e,from:"visitor",status:0}),t.recored.push({date:(new Date).getTime(),content:e,from:"visitor",status:0}));var n=t.options.ecselfList;if(n)for(var o in n){var a=n[o];a.eclangPk&&a.eclangPk==t.options.langPk&&(t.nc={number:a.number||t.nc.number,answer:a.answer||t.nc.answer,questions:a.questions?a.questions.split(";"):""})}return 3==t.options.robotSetting?t.iRobot(e):(1==t.options.robotSetting||4==t.options.robotSetting)&&t.options.ywList.indexOf(t.options.companyPk)>-1?t.ywRobot(e):4==t.options.robotSetting&&n?t.umpRobot(e):1==t.options.robotSetting&&t.oldNcRobot(e),!0},umpRobot:function(e){if(e){var i=this,n=i.options.dialogue;t.ajax({type:"POST",url:"echatManager.do",data:{method:"getAnswer",companyPk:i.options.companyPk,visitorId:i.options.visitorId,chatId:i.options.chatId,channel:"web",question:e},dataType:"json"}).done(function(t){if(i.click=!1,t.response){if(1==t.response.length){var o=t.response[0].content;if(t.suggestions&&t.suggestions.length>=1)for(var a=0,s=t.suggestions.length;a<s;a++)o+="<b/><div class='robotSuggsetion'>"+t.suggestions[a]+"</div>";n.showMsg({date:(new Date).getTime(),content:o,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:o,from:"robot"})}}else i.answerFail(e)}).fail(function(){i.isUse&&(i.click=!1,i.answerFail(e))})}},answerFail:function(e){if(robot.ncRobotTime++,robot.ncRobotTime>=robot.nc.number){if(robot.choose)return;1==robot.choose,robot.cf||(robot.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==robot.cf?(robot.options.changeToNormal(),robot.choose=!1):(robot.cf=null,dialogue.showMsg({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),robot.recored.push({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),robot.choose=!1,robot.ncRobotTime=0))}else{var t=0;for(var i in robot.nc.questions){var n=robot.nc.questions[i];if(n==e){if(t=1,robot.choose)return;1==robot.choose,robot.cf||(robot.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==robot.cf?(robot.choose=!1,robot.options.changeToNormal()):(robot.cf=null,t=0,robot.choose=!1,robot.ncRobotTime=0))}}0==t&&(dialogue.showMsg({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),robot.recored.push({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}))}},iRobot:function(e){if(e){var i=this;t.ajax({url:"http://vdev.icontek.com:28080/queryj/x/ROOT->ucctest/"+i.options.companyPk+(new Date).getTime()+"/"+e}).done(function(e){var t="";e.confidence>=i.confidence&&e.answer&&(t+=e.answer.replace(/\+/g," ")+"<br />",i.options.dialogue.showMsg({date:(new Date).getTime(),content:t,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:t,from:"robot"}));var n=confirm("不能查找到答案，是否需要转人工服务?");1==n&&i.options.changeToNormal()})}},cf:null,ncRobot:function(e){if(e){var i=this,n=i.options.dialogue;t.ajax({type:"POST",url:"echatManager.do?method=automaticResponse",data:{companyPk:i.options.companyPk,question:e,chatId:i.options.chatId,visitorName:i.options.visitorName,langPk:i.options.langPk,"true":i.click},dataType:"json"}).done(function(t){if(i.isUse)if(i.click=!1,1==t.reply)i.ncRobotTime=0,n.showMsg({date:(new Date).getTime(),content:t.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:t.answer,from:"robot"});else if(i.ncRobotTime++,i.ncRobotTime>=i.nc.number){if(i.choose)return;1==i.choose,i.cf||(i.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==i.cf?(i.options.changeToNormal(),i.choose=!1):(i.cf=null,n.showMsg({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.choose=!1,i.ncRobotTime=0))}else{var o=0;for(var a in i.nc.questions){var s=i.nc.questions[a];if(s==e){if(o=1,i.choose)return;1==i.choose,i.cf||(i.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==i.cf?(i.choose=!1,i.options.changeToNormal()):(i.cf=null,o=0,i.choose=!1,i.ncRobotTime=0))}}0==o&&(n.showMsg({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),
content:i.nc.answer,from:"robot"}))}}).fail(function(){if(i.isUse)if(i.click=!1,i.ncRobotTime++,i.ncRobotTime>=i.nc.number){if(i.choose)return;1==i.choose,i.cf||(i.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==i.cf?(i.choose=!1,i.options.changeToNormal()):(i.cf=null,n.showMsg({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.choose=!1,i.ncRobotTime=0))}else{var t=0;for(var o in i.nc.questions){var a=i.nc.questions[o];if(a==e){if(t=1,i.choose)return;1==i.choose,i.cf||(i.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==i.cf?(i.choose=!1,i.options.changeToNormal()):(i.cf=null,t=0,i.choose=!1,i.ncRobotTime=0))}}0==t&&(n.showMsg({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}))}})}},ywRobot:function(e){if(e){var n=this,o=n.options.dialogue;t.ajax({type:"POST",url:"echatManager.do?method=loadSelfService2",data:{chatId:n.options.chatId,companyPk:n.options.companyPk,content:encodeURIComponent(e)},dataType:"json"}).done(function(e){var a="";e&&"Artificial customer service"!=e.answer&&null!=e.answer&&""!=e.answer&&e.answer!=i?(a=e.answer.replace(/\+/g," ")+"<br />",o.showMsg({date:(new Date).getTime(),content:a+"<br />单击<a href='javascript:' class='robo'><span style='color: red;'>转人工</span></a>进行提问。",from:"robot",status:0}),n.recored.push({date:(new Date).getTime(),content:a+"<br />单击<a href='javascript:' class='robo'><span style='color: red;'>转人工</span></a>进行提问。",from:"robot"})):(o.showMsg({date:(new Date).getTime(),content:"<div id='conId'>您好，我正在成长过程中，您的这个问题可能已经超出了我目前的知识范围。单击<a href='javascript:' class='robo'><span style='color: red;'>转人工</span></a>进行提问。</div>",from:"robot",status:0}),n.recored.push({date:(new Date).getTime(),content:"<div id='conId'>您好，我正在成长过程中，您的这个问题可能已经超出了我目前的知识范围。单击<a href='javascript:' class='robo'><span style='color: red;'>转人工</span></a>进行提问。</div>",from:"robot"})),t(".robo").click(function(){n.options.changeToNormal()})})}},oldNcRobot:function(e){if(e){var i=this,n=i.options.dialogue,o="";t.ajax({type:"POST",url:"echatManager.do?method=loadSelfService",data:{chatId:i.options.chatId,companyPk:i.options.companyPk,content:encodeURIComponent(e)},dataType:"json"}).done(function(e){if(e&&e.length>1)t.each(e,function(t){o+=e[t].text.replace(/\+/g," ")+"<br />"}),n.showMsg({msgid:"",date:(new Date).getTime(),content:o,from:"client",status:0});else if(e&&1==e.length)o+="<div>"+e[0].text.replace(/\+/g," ")+"</div>",n.showMsg({msgid:"",date:(new Date).getTime(),content:o,from:"client",status:0});else{var a=confirm("不能查找到答案，是否需要转人工服务?");1==a?i.options.changeToNormal():i.ncRobotTime=0}})}}},t.robot=function(e){var t=new n(e);return t.recored=[],t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={companyPk:"",defaultLangPk:"",langMap:{},show:function(e){}},this.options=t.extend({},this.defaults,e)};n.prototype={type:{system:1,operator:2},key:{welcome_1:1,welcome_2:2,chat_ad:3,cs_busy:4,no_answer_close:5,no_answer_hint:6,dialog_start:7},langMap:{},init:function(){var e=this;return Object.keys(e.options.langMap).length>0?void(e.langMap=e.options.langMap):void t.ajax({type:"POST",url:"echatManager.do?method=getLangList",async:!1,data:{companyPk:e.options.companyPk,langPk:e.options.defaultLangPk},dataType:"json"}).done(function(t){t&&(e.langMap=t)})},show:function(e,i){var n=this;1==e?n.langMap&&n.langMap[i]&&n.options.show(n.langMap[i]):t.ajax({type:"POST",url:"echatManager.do?method=getLangListByPk",async:!1,data:{companyPk:n.options.companyPk,langPk:n.options.defaultLangPk,langType:e,langKey:i},dataType:"json"}).done(function(e){e&&n.options.show(e)})}},t.langTip=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={open:"1",storage:null,time:6e4,num:5,blockTime:5e3,url:"./overLoad.jsp"},this.options=t.extend({},this.defaults,e)};n.prototype={init:function(){if("0"!=this.options.open){var t=this,i=this.options.storage,n=i.get("vLimit"),o=i.get("isLimit"),a=[],s=(new Date).getTime();if(n){if("islimited"==o&&s-n[n.length-1].time<=t.options.blockTime)return void(e.location.href=t.options.url);"islimited"==o&&(n=[]),i.set("isLimit","");for(var r in n)s-n[r].time<t.options.time&&a.push({time:n[r].time});if(a.push({time:s}),i.set("vLimit",a),a.length>t.options.num)return i.set("isLimit","islimited"),void(e.location.href=t.options.url)}else a.push({time:s}),i.set("vLimit",a)}}},t.visitLimit=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};n.prototype={allDB:{},id:0,db:{},add:function(e){var t=this,i={msgId:e.msgId?e.msgId:"",type:e.type,content:e.content,time:e.date?e.date:(new Date).getTime(),isRevoke:!!e.isRevoke&&e.isRevoke,hasChecked:!!e.hasChecked&&e.hasChecked,status:e.status?e.status:0,saveIn:e.saveIn?e.saveIn:0,received:0,checkSend:0};t.db[t.id]=i,t.allDB[t.id]=i,t.id++},clear:function(){var e=this;e.db={}},last:function o(){var e=this,o=0;for(var t in e.db)!isNaN(Number(t))&&Number(o)<=Number(t)&&(o=t);return o},setKey:function(e,t,i){var n=this;for(var o in n.db)e==o&&(n.db[o][t]=i,n.allDB[o][t]=i)},set:function(e,t,i){var n=this;for(var o in n.db)n.db[o].msgId==e&&(n.db[o][t]=i,n.allDB[o][t]=i)},get:function(e){var t=this;for(var i in t.db)if(t.db[i].msgId==e)return t.db[i]},getAll:function(){return this.db}},t.msgdb=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={userDatas:null,storage:null},this.options=t.extend({},this.defaults,e)};n.prototype={init:function(e){var i=nowtime.getTime(),n=this,o=n.options.storage,a=o.get("ncVisitor")?o.get("ncVisitor"):{},s=n.getTrace(),r=s.result,c=n.getInfo();o.set("visitorId",c.visitorId),o.set("visitorName",c.visitorName),c=n.changeFirstTime(c,r),a.trace=r,a.info=c,o.set("ncVisitor",a);var l=c;i-c.lastTime>6e5||!s.hasVal?l.trace=[s.item]:l.trace=[],t.ajax({url:baseUrl+"/visitorMonitor.do",type:"get",dataType:"jsonp",data:{method:"setVisitorMonitor",monitorInfo:encodeURIComponent(JSON.stringify(l))}})},changeFirstTime:function(e,t){var i,n=e,o=n.firstTime;for(var a in t)(!i||i>t[a].firstInTime)&&(i&&new Date(t[a].firstInTime).Format("yyyy-mm-dd")!=nowtime.Format("yyyy-mm-dd")||(i=t[a].firstInTime));return n.firstTime=i?i:o,new Date(n.firstTime).Format("yyyy-mm-dd")!=nowtime.Format("yyyy-mm-dd")&&(n.firstTime=n.lastTime),n},get:function(){var e=mo.options.storage,t=e.get("route");return t},getInfo:function(){var e=this,t=(e.options.storage,e.options.userDatas),i=t.getJsonStr(),n=e.getAllTime(i);return i.firstTime=n.firstTime,i.lastTime=n.lastTime,i.status="broswer",i},getAllTime:function(e){var t=nowtime.getTime();return{firstTime:e&&e.firstTime?e.firstTime:t,lastTime:t}},getTrace:function(){var e=nowtime.getTime(),i=this,n=i.options.storage,o=n.get("ncVisitor"),a=o?o.trace:null,s=[],r=null,c=!1;if(a){for(var l in a)if(a[l]){var d=a[l];decodeURIComponent(d.url)==location.href&&(c=!0,d.inTime=e,r=d),s.push(d)}c||(r={url:location.href,firstInTime:e,inTime:e,title:t("title").html()},s.push(r))}else r={url:location.href,firstInTime:e,inTime:e,title:t("title").html()},s.push(r);return s.length>10&&(s=s.sort(function(e,t){return e.inTime<t.inTime}),s.pop()),s=s.sort(function(e,t){return e.firstInTime<t.firstInTime}),{item:r,result:s,hasVal:c}}},t.monitor=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(e){function t(t){var i=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(t.target).ajaxSubmit(i))}function i(t){var i=t.target,n=e(i);if(!n.is("[type=submit],[type=image]")){var o=n.closest("[type=submit]");if(0===o.length)return;i=o[0]}var a=this;if(a.clk=i,"image"==i.type)if(void 0!==t.offsetX)a.clk_x=t.offsetX,a.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var s=n.offset();a.clk_x=t.pageX-s.left,a.clk_y=t.pageY-s.top}else a.clk_x=t.pageX-i.offsetLeft,a.clk_y=t.pageY-i.offsetTop;setTimeout(function(){a.clk=a.clk_x=a.clk_y=null},100)}function n(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var o={};o.fileapi=void 0!==e("<input type='file'/>").get(0).files,o.formdata=void 0!==window.FormData;var a=!!e.fn.prop;e.fn.attr2=function(){if(!a)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t){function i(i){var n,o,a=e.param(i,t.traditional).split("&"),s=a.length,r=[];for(n=0;n<s;n++)a[n]=a[n].replace(/\+/g," "),o=a[n].split("="),r.push([decodeURIComponent(o[0]),decodeURIComponent(o[1])]);return r}function s(n){for(var o=new FormData,a=0;a<n.length;a++)o.append(n[a].name,n[a].value);if(t.extraData){var s=i(t.extraData);for(a=0;a<s.length;a++)s[a]&&o.append(s[a][0],s[a][1])}t.data=null;var r=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:c||"POST"});t.uploadProgress&&(r.xhr=function(){var i=e.ajaxSettings.xhr();return i.upload&&i.upload.addEventListener("progress",function(e){var i=0,n=e.loaded||e.position,o=e.total;e.lengthComputable&&(i=Math.ceil(n/o*100)),t.uploadProgress(e,n,o,i)},!1),i}),r.data=null;var l=r.beforeSend;return r.beforeSend=function(e,i){t.formData?i.data=t.formData:i.data=o,l&&l.call(this,e,i)},e.ajax(r)}function r(i){function o(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(i){n("cannot get iframe.contentWindow document: "+i)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(i){n("cannot get iframe.contentDocument: "+i),t=e.document}return t}function s(){function t(){try{var e=o(v).readyState;n("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(i){n("Server abort: ",i," (",i.name,")"),r(D),I&&clearTimeout(I),I=void 0}}var i=u.attr2("target"),a=u.attr2("action"),s="multipart/form-data",l=u.attr("enctype")||u.attr("encoding")||s;x.setAttribute("target",f),c&&!/post/i.test(c)||x.setAttribute("method","POST"),a!=m.url&&x.setAttribute("action",m.url),m.skipEncodingOverride||c&&!/post/i.test(c)||u.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),m.timeout&&(I=setTimeout(function(){T=!0,r(S)},m.timeout));var d=[];try{if(m.extraData)for(var p in m.extraData)m.extraData.hasOwnProperty(p)&&(e.isPlainObject(m.extraData[p])&&m.extraData[p].hasOwnProperty("name")&&m.extraData[p].hasOwnProperty("value")?d.push(e('<input type="hidden" name="'+m.extraData[p].name+'">').val(m.extraData[p].value).appendTo(x)[0]):d.push(e('<input type="hidden" name="'+p+'">').val(m.extraData[p]).appendTo(x)[0]));m.iframeTarget||g.appendTo("body"),v.attachEvent?v.attachEvent("onload",r):v.addEventListener("load",r,!1),setTimeout(t,15);try{x.submit()}catch(h){var y=document.createElement("form").submit;y.apply(x)}}finally{x.setAttribute("action",a),x.setAttribute("enctype",l),i?x.setAttribute("target",i):u.removeAttr("target"),e(d).remove()}}function r(t){if(!y.aborted&&!M){if(C=o(v),C||(n("cannot access response document"),t=D),t===S&&y)return y.abort("timeout"),void k.reject(y,"timeout");if(t==D&&y)return y.abort("server abort"),void k.reject(y,"error","server abort");if(C&&C.location.href!=m.iframeSrc||T){v.detachEvent?v.detachEvent("onload",r):v.removeEventListener("load",r,!1);var i,a="success";try{if(T)throw"timeout";var s="xml"==m.dataType||C.XMLDocument||e.isXMLDoc(C);if(n("isXml="+s),!s&&window.opera&&(null===C.body||!C.body.innerHTML)&&--L)return n("requeing onLoad callback, DOM not available"),void setTimeout(r,250);var c=C.body?C.body:C.documentElement;y.responseText=c?c.innerHTML:null,y.responseXML=C.XMLDocument?C.XMLDocument:C,s&&(m.dataType="xml"),y.getResponseHeader=function(e){var t={"content-type":m.dataType};return t[e.toLowerCase()]},c&&(y.status=Number(c.getAttribute("status"))||y.status,y.statusText=c.getAttribute("statusText")||y.statusText);var l=(m.dataType||"").toLowerCase(),d=/(json|script|text)/.test(l);if(d||m.textarea){var u=C.getElementsByTagName("textarea")[0];if(u)y.responseText=u.value,y.status=Number(u.getAttribute("status"))||y.status,y.statusText=u.getAttribute("statusText")||y.statusText;else if(d){var f=C.getElementsByTagName("pre")[0],h=C.getElementsByTagName("body")[0];f?y.responseText=f.textContent?f.textContent:f.innerText:h&&(y.responseText=h.textContent?h.textContent:h.innerText)}}else"xml"==l&&!y.responseXML&&y.responseText&&(y.responseXML=O(y.responseText));try{j=V(y,l,m)}catch(w){a="parsererror",y.error=i=w||a}}catch(w){n("error caught: ",w),a="error",y.error=i=w||a}y.aborted&&(n("upload aborted"),a=null),y.status&&(a=y.status>=200&&y.status<300||304===y.status?"success":"error"),"success"===a?(m.success&&m.success.call(m.context,j,"success",y),k.resolve(y.responseText,"success",y),p&&e.event.trigger("ajaxSuccess",[y,m])):a&&(void 0===i&&(i=y.statusText),m.error&&m.error.call(m.context,y,a,i),k.reject(y,"error",i),p&&e.event.trigger("ajaxError",[y,m,i])),p&&e.event.trigger("ajaxComplete",[y,m]),p&&!--e.active&&e.event.trigger("ajaxStop"),m.complete&&m.complete.call(m.context,y,a),M=!0,m.timeout&&clearTimeout(I),setTimeout(function(){m.iframeTarget?g.attr("src",m.iframeSrc):g.remove(),y.responseXML=null},100)}}}var l,d,m,p,f,g,v,y,w,b,T,I,x=u[0],k=e.Deferred();if(k.abort=function(e){y.abort(e)},i)for(d=0;d<h.length;d++)l=e(h[d]),a?l.prop("disabled",!1):l.removeAttr("disabled");if(m=e.extend(!0,{},e.ajaxSettings,t),m.context=m.context||m,f="jqFormIO"+(new Date).getTime(),m.iframeTarget?(g=e(m.iframeTarget),b=g.attr2("name"),b?f=b:g.attr2("name",f)):(g=e('<iframe name="'+f+'" src="'+m.iframeSrc+'" />'),g.css({position:"absolute",top:"-1000px",left:"-1000px"})),v=g[0],y={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var i="timeout"===t?"timeout":"aborted";n("aborting upload... "+i),this.aborted=1;try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(o){}g.attr("src",m.iframeSrc),y.error=i,m.error&&m.error.call(m.context,y,i,t),p&&e.event.trigger("ajaxError",[y,m,i]),m.complete&&m.complete.call(m.context,y,i)}},p=m.global,p&&0===e.active++&&e.event.trigger("ajaxStart"),p&&e.event.trigger("ajaxSend",[y,m]),m.beforeSend&&m.beforeSend.call(m.context,y,m)===!1)return m.global&&e.active--,k.reject(),k;if(y.aborted)return k.reject(),k;w=x.clk,w&&(b=w.name,b&&!w.disabled&&(m.extraData=m.extraData||{},m.extraData[b]=w.value,"image"==w.type&&(m.extraData[b+".x"]=x.clk_x,m.extraData[b+".y"]=x.clk_y)));var S=1,D=2,P=e("meta[name=csrf-token]").attr("content"),N=e("meta[name=csrf-param]").attr("content");N&&P&&(m.extraData=m.extraData||{},m.extraData[N]=P),m.forceSync?s():setTimeout(s,10);var j,C,M,L=50,O=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},_=e.parseJSON||function(e){return window.eval("("+e+")")},V=function(t,i,n){var o=t.getResponseHeader("content-type")||"",a="xml"===i||!i&&o.indexOf("xml")>=0,s=a?t.responseXML:t.responseText;return a&&"parsererror"===s.documentElement.nodeName&&e.error&&e.error("parsererror"),n&&n.dataFilter&&(s=n.dataFilter(s,i)),"string"==typeof s&&("json"===i||!i&&o.indexOf("json")>=0?s=_(s):("script"===i||!i&&o.indexOf("javascript")>=0)&&e.globalEval(s)),s};return k}if(!this.length)return n("ajaxSubmit: skipping submit process - no element selected"),this;var c,l,d,u=this;"function"==typeof t?t={success:t}:void 0===t&&(t={}),c=t.type||this.attr2("method"),l=t.url||this.attr2("action"),d="string"==typeof l?e.trim(l):"",d=d||window.location.href||"",d&&(d=(d.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:d,success:e.ajaxSettings.success,type:c||e.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var m={};if(this.trigger("form-pre-serialize",[this,t,m]),m.veto)return n("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&t.beforeSerialize(this,t)===!1)return n("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var p=t.traditional;void 0===p&&(p=e.ajaxSettings.traditional);var f,h=[],g=this.formToArray(t.semantic,h);if(t.data&&(t.extraData=t.data,f=e.param(t.data,p)),t.beforeSubmit&&t.beforeSubmit(g,this,t)===!1)return n("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[g,this,t,m]),m.veto)return n("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var v=e.param(g,p);f&&(v=v?v+"&"+f:f),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+v,t.data=null):t.data=v;var y=[];if(t.resetForm&&y.push(function(){u.resetForm()}),t.clearForm&&y.push(function(){u.clearForm(t.includeHidden)}),!t.dataType&&t.target){var w=t.success||function(){};y.push(function(i){var n=t.replaceTarget?"replaceWith":"html";e(t.target)[n](i).each(w,arguments)})}else t.success&&y.push(t.success);if(t.success=function(e,i,n){for(var o=t.context||this,a=0,s=y.length;a<s;a++)y[a].apply(o,[e,i,n||u,u])},t.error){var b=t.error;t.error=function(e,i,n){var o=t.context||this;b.apply(o,[e,i,n,u])}}if(t.complete){var T=t.complete;t.complete=function(e,i){var n=t.context||this;T.apply(n,[e,i,u])}}var I=e("input[type=file]:enabled",this).filter(function(){return""!==e(this).val()}),x=I.length>0,k="multipart/form-data",S=u.attr("enctype")==k||u.attr("encoding")==k,D=o.fileapi&&o.formdata;n("fileAPI :"+D);var P,N=(x||S)&&!D;t.iframe!==!1&&(t.iframe||N)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){P=r(g)}):P=r(g):P=(x||S)&&D?s(g):e.ajax(t),u.removeData("jqxhr").data("jqxhr",P);for(var j=0;j<h.length;j++)h[j]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(o){if(o=o||{},o.delegation=o.delegation&&e.isFunction(e.fn.on),!o.delegation&&0===this.length){var a={s:this.selector,c:this.context};return!e.isReady&&a.s?(n("DOM not ready, queuing ajaxForm"),e(function(){e(a.s,a.c).ajaxForm(o)}),this):(n("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return o.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,i).on("submit.form-plugin",this.selector,o,t).on("click.form-plugin",this.selector,o,i),this):this.ajaxFormUnbind().bind("submit.form-plugin",o,t).bind("click.form-plugin",o,i)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,i){var n=[];if(0===this.length)return n;var a,s=this[0],r=this.attr("id"),c=t?s.getElementsByTagName("*"):s.elements;if(c&&!/MSIE [678]/.test(navigator.userAgent)&&(c=e(c).get()),r&&(a=e(':input[form="'+r+'"]').get(),a.length&&(c=(c||[]).concat(a))),!c||!c.length)return n;var l,d,u,m,p,f,h;for(l=0,f=c.length;l<f;l++)if(p=c[l],u=p.name,u&&!p.disabled)if(t&&s.clk&&"image"==p.type)s.clk==p&&(n.push({name:u,value:e(p).val(),type:p.type}),n.push({name:u+".x",value:s.clk_x},{name:u+".y",value:s.clk_y}));else if(m=e.fieldValue(p,!0),m&&m.constructor==Array)for(i&&i.push(p),d=0,h=m.length;d<h;d++)n.push({name:u,value:m[d]});else if(o.fileapi&&"file"==p.type){i&&i.push(p);var g=p.files;if(g.length)for(d=0;d<g.length;d++)n.push({name:u,value:g[d],type:p.type});else n.push({name:u,value:"",type:p.type})}else null!==m&&"undefined"!=typeof m&&(i&&i.push(p),n.push({name:u,value:m,type:p.type,required:p.required}));if(!t&&s.clk){var v=e(s.clk),y=v[0];u=y.name,u&&!y.disabled&&"image"==y.type&&(n.push({name:u,value:v.val()}),n.push({name:u+".x",value:s.clk_x},{name:u+".y",value:s.clk_y}))}return n},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var i=[];return this.each(function(){var n=this.name;if(n){var o=e.fieldValue(this,t);if(o&&o.constructor==Array)for(var a=0,s=o.length;a<s;a++)i.push({name:n,value:o[a]});else null!==o&&"undefined"!=typeof o&&i.push({name:this.name,value:o})}}),e.param(i)},e.fn.fieldValue=function(t){for(var i=[],n=0,o=this.length;n<o;n++){var a=this[n],s=e.fieldValue(a,t);null===s||"undefined"==typeof s||s.constructor==Array&&!s.length||(s.constructor==Array?e.merge(i,s):i.push(s))}return i},e.fieldValue=function(t,i){var n=t.name,o=t.type,a=t.tagName.toLowerCase();if(void 0===i&&(i=!0),i&&(!n||t.disabled||"reset"==o||"button"==o||("checkbox"==o||"radio"==o)&&!t.checked||("submit"==o||"image"==o)&&t.form&&t.form.clk!=t||"select"==a&&t.selectedIndex==-1))return null;if("select"==a){var s=t.selectedIndex;if(s<0)return null;for(var r=[],c=t.options,l="select-one"==o,d=l?s+1:c.length,u=l?s:0;u<d;u++){var m=c[u];if(m.selected){var p=m.value;if(p||(p=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value),l)return p;r.push(p)}}return r}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var i=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var n=this.type,o=this.tagName.toLowerCase();i.test(n)||"textarea"==o?this.value="":"checkbox"==n||"radio"==n?this.checked=!1:"select"==o?this.selectedIndex=-1:"file"==n?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(t===!0&&/hidden/.test(n)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==_typeof(this.reset)&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var i=this.type;if("checkbox"==i||"radio"==i)this.checked=t;else if("option"==this.tagName.toLowerCase()){var n=e(this).parent("select");t&&n[0]&&"select-one"==n[0].type&&n.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}),function(e,t,i){var n=function(e,i){this.$el=e,this.defaults={other:function(e,t){},uploadType:"all",size:0,inputImage:!1,callback:function(e){},error:function(e){}},this.options=t.extend({},this.defaults,i)};n.prototype={errorCodes:{E001:"身份认证错误",E002:"上传文件类型错误，只允许上传.jpg .jpeg .bmp .png .doc .docx .xls .xlsx .pdf .txt .amr .ppt .pptx .csv",E003:""},init:function(){var e=this;this.options.uploadType,this.options.size;e.create()},create:function(){var e=this,i=this.options.uploadType,n=this.options.size,o=e.$el;e.$el.find(".fileup").length>0&&e.$el.find(".fileup").remove();var a="/any800/echatManager.do?method=uploadFile&fromType=visitor&chatId="+ucc.chatID,s="*/*";e.options.inputImage&&(s="image/*");var r='<form class="fileup" contentType="text/html"   method="post"  enctype="multipart/form-data" action="'+a+'"><input multiple="false" type="file" name="uploadField" accept="'+s+'" /></form>';t(o).append(r);var c=e.$el.find(".fileup").find("input:file");c.on("change",function(){var t=c[0],o=t.value,a=o.substring(o.lastIndexOf(".")).toLowerCase();return e.checkType(a,i)?t.files&&n&&n<t.files[0].size?(e.create(),void e.options.error("size")):void e.options.other(e,t.files?t.files[0].name:o,(new Date).getTime()):(e.create(),void e.options.error("type"))})},submit:function(e,t){var i=this;0!=i.$el.find(".fileup").length&&i.$el.find(".fileup").ajaxSubmit(function(n){var o=JSON.parse(n);o.success?i.options.callback(o.content,e,t):i.options.error("other",e,o.errorMessage,t),i.create()})},checkType:function(e,t){if(e=e.toLowerCase(),"all"==t)return e.match(/.gif|.jpg|.jpeg|.bmp|.png|.doc|.docx|.xls|.xlsx|.pdf|.txt/i);var i=t.split(";");if(i.length>0){for(var n in i)if("image"==i[n]){if(e.match(/.gif|.jpg|.jpeg|.bmp|.png/i))return!0}else if("doc"==i[n]){if(e.match(/.doc|.docx/i))return!0}else if("xls"==i[n]){if(e.match(/.xls|.xlsx/i))return!0}else if("pdf"==i[n]){if(e.match(/.pdf/i))return!0}else if("txt"==i[n]&&e.match(/.txt/i))return!0;return!1}}},t.fn.uploadFile=function(e){var i=new n(t(this),e);return i.init(),i}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={storage:null,loadMore:function(e){}},this.options=t.extend({},this.defaults,e)};n.prototype={current:[],history:[],time:0,init:function(){this.current=this.options.storage.get("localCur")?this.options.storage.get("localCur"):[],this.history=this.options.storage.get("localHis")?this.options.storage.get("localHis"):[],this.time=this.options.storage.get("localTim")?this.options.storage.get("localTim"):(new Date).getTime(),this.history.length>0&&(this.lastChat=this.history.length-1,this.lastId=this.history[this.lastChat].data.length-1)},setCurrent:function(e){var t=[];for(var i in e)if(!isNaN(Number(i))){var n=e[i];if(0==n.saveIn&&!n.isRevoke&&"system"!=n.type&&1!=n.status&&2!=n.checkSend){var o="client"==n.type?dialogue.getAttr("operatorName"):"visitor"==n.type?userDatas.getVisitorInfo().visitorName:"robot"==n.type?"机器人":"";t.push({from:n.type,content:n.content,time:n.time,opName:o})}}this.options.storage.set("localTim",this.time),this.options.storage.set("localCur",t),this.current=t},saveCurrent:function(){if(this.current.length>0){if(this.history.length>0&&this.time==this.history[this.history.length-1].time)return;this.history.push({data:this.current,time:this.time}),this.current=[],this.save()}this.time=(new Date).getTime(),this.options.storage.set("localTim",this.time)},save:function(){this.options.storage.set("localCur",this.current),this.options.storage.set("localHis",this.history)},lastId:0,lastChat:0,page:5,loadMore:function(){for(var e=[],t=0,i=this.page;t<i;){var n=this.preload(this.lastChat,this.lastId);if(!n)break;e.push(n),"date"!=n.type&&t++}this.options.loadMore(e)},preload:function(e,t){if(e==-1)return"";if(t==-1)return this.lastChat=e-1,this.lastChat==-1?"":(this.lastId=this.history[this.lastChat].data.length-1,{type:"date",time:this.history[this.lastChat].time});var i=this.history[this.lastChat].data[this.lastId];return this.lastId=this.lastId-1,i}},t.localHistory=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};n.prototype={defered:null,init:function(){var e=this;t(".confirmBox").length>0||(t("body").append("<div class='confirmBox'><div class='body'><div class='title'></div><div class='rightBtn'></div><div class='wrongBtn'></div></div></div>"),t(".confirmBox .rightBtn").on("click",function(){e.defered&&e.defered.resolve(!0),t(".confirmBox").hide(),e.defered=null}),t(".confirmBox .wrongBtn").on("click",function(){e.defered&&e.defered.resolve(!1),t(".confirmBox").hide(),e.defered=null}),t(".confirmBox").hide())},create:function(e,i,n){var o=this;return i=i?i:"确定",n=n?n:"取消",t(".confirmBox").show(),o.switchTitle(e,i,n),o.defered&&o.defered.resolve(!1),o.defered=new t.Deferred,o.defered.promise()},switchTitle:function(e,i,n){t(".confirmBox .title").html(e),t(".confirmBox .rightBtn").html(i),t(".confirmBox .wrongBtn").html(n);var o=t(".confirmBox").height()/2-t(".confirmBox .body").height()/2;t(".confirmBox .body").css({marginTop:o})}},t.confirm=function(e){var t=new n(e);return t.init(),t}}(window,jQuery);
"use strict";!function(e,t,o){var n=function(e){this.defaults={path:"/any800/UccWebSocket/",visitorId:"",message:function(e,t){},deal:function(e,t,o){},connect:function(e){},confirmSend:function(e){},leaveCover:function(){},open:function(){}},this.options=t.extend({},this.defaults,e)},c=function(e){var t=this;return t.chatId=e.chatID,t.type=e.type?e.type:"VS_CHAT",t.content=JSON.stringify(new r(e.message)),t.messageId="Other"+e.date,t},s=function(e){var t=this;return t.chatId=e.chatID,t.type=e.type?e.type:"VS_CHAT",t.content=e.message,t.messageId="Other"+e.date,t},i=function(e){var t=this;return t.type="RECEIPTS",t.messageId=e,t},r=function(e){var t=this;return t.msg=e,t},a=new t.Deferred;n.prototype={isWork:!1,isConnect:!1,connectTimeout:null,websocket:null,init:function(){var t=this;storage.get("webSocketIsWork");return e.WebSocket&&e.WebSocket.prototype.send&&"true"==t.options.isWs&&(t.isWork=!0),t.isWork&&(t.reconnectionFun(),t.connect()),t.isWork?a.promise():a.resolve(!1)},reconnectionFun:function(){var t=this;t.isWork&&!function(e,t){"function"==typeof define&&define.amd?define([],t):"undefined"!=typeof module&&module.exports?module.exports=t():e.ReconnectingWebSocket=t()}(this,function(){function t(e,n,c){function s(e,t){var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,!1,!1,t),o}var i={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3};c||(c={});for(var r in i)"undefined"!=typeof c[r]?this[r]=c[r]:this[r]=i[r];this.url=e,this.reconnectAttempts=0,this.readyState=o.CONNECTING,this.protocol=null;var a,d=this,u=!1,l=!1,p=document.createElement("div");p.addEventListener("open",function(e){d.onopen(e)}),p.addEventListener("close",function(e){d.onclose(e)}),p.addEventListener("connecting",function(e){d.onconnecting(e)}),p.addEventListener("message",function(e){d.onmessage(e)}),p.addEventListener("error",function(e){d.onerror(e)}),this.addEventListener=p.addEventListener.bind(p),this.removeEventListener=p.removeEventListener.bind(p),this.dispatchEvent=p.dispatchEvent.bind(p),this.open=function(e){a=new o(d.url,n||[]),e||p.dispatchEvent(s("connecting")),(d.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",d.url);var c=a,i=setTimeout(function(){(d.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",d.url),l=!0,c.close(),l=!1},d.timeoutInterval);a.onopen=function(n){console.log("opened"),clearTimeout(i),(d.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","onopen",d.url),d.protocol=a.protocol,d.readyState=o.OPEN,d.reconnectAttempts=0;var c=s("open");c.isReconnect=e,e=!1,p.dispatchEvent(c)},a.onclose=function(n){if(clearTimeout(i),console.log("event.code:"+n.code),console.log(n.reason),!n.code||"1004"!=n.code&&"1005"!=n.code&&"1006"!=n.code||(u=!0),a=null,u){d.readyState=o.CLOSED;var c=s("close");c.code=n.code,p.dispatchEvent(c)}else{d.readyState=o.CONNECTING;var c=s("connecting");c.code=n.code,c.reason=n.reason,c.wasClean=n.wasClean,p.dispatchEvent(c),e||l||((d.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","onclose",d.url),p.dispatchEvent(s("close")));var i=d.reconnectInterval*Math.pow(d.reconnectDecay,d.reconnectAttempts);setTimeout(function(){d.reconnectAttempts++,d.open(!0)},i>d.maxReconnectInterval?d.maxReconnectInterval:i)}},a.onmessage=function(e){(d.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",d.url,e.data);var o=s("message");o.data=e.data,p.dispatchEvent(o)},a.onerror=function(e){(d.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","onerror",d.url,e),p.dispatchEvent(s("error"))}},1==this.automaticOpen&&this.open(!1),this.send=function(e){if(a)return(d.debug||t.debugAll)&&console.debug("ReconnectingWebSocket","send",d.url,e),a.send(e)},this.close=function(e,t){"undefined"==typeof e&&(e=1e3),console.log("debug: WebSocket closed. code="+e),u=!0,a&&a.close(e,t)},this.refresh=function(){a&&a.close()}}var o=e.WebSocket||e.MozWebSocket;return t.prototype.onopen=function(e){},t.prototype.onclose=function(e){},t.prototype.onconnecting=function(e){},t.prototype.onmessage=function(e){},t.prototype.onerror=function(e){},t.debugAll=!1,t.CONNECTING=o.CONNECTING,t.OPEN=o.OPEN,t.CLOSING=o.CLOSING,t.CLOSED=o.CLOSED,t})},getWebSocketUri:function(){return("http:"==e.location.protocol?"ws://":"wss://")+(""==document.location.hostname?"localhost":document.location.hostname)+(""==document.location.port?"":":"+document.location.port)+this.options.path+this.options.visitorId},connectType:0,connect:function(){var t=this;if(t.isWork&&(!t.websocket||t.websocket.readyState==WebSocket.CLOSED)){e.WebSocket||e.MozWebSocket;t.websocket=new this.ReconnectingWebSocket(t.getWebSocketUri(),null,{}),t.websocket.onopen=t.doOpen,t.websocket.onerror=t.doError,t.websocket.onclose=t.doClose,t.websocket.onmessage=t.doMessage,t.connectType=1}},doOpen:function(){var e=this;a.resolve(!0),console.log("Info: WebSocket connection opened."),e.isConnect=!0,webSocket.hasOpend=!0,webSocket.startTimeout(),webSocket.pingTime=0,webSocket.pongTime=0,webSocket.options.open(),webSocket.connectType=2,storage.set("webSocketIsWork",!0)},pingTime:0,pongTime:0,sendPing:function(){var e=this;e.pingTime&&e.pongTime&&(e.pingTime-e.pongTime>3e3?e.websocket.isConnect=!1:e.websocket.isConnect=!0),e.pingTime=(new Date).getTime();var t=new c({date:(new Date).getTime(),chatId:"",type:"PING"});e.websocket&&e.websocket.send(JSON.stringify(t))},startTimeout:function(){if(this.isWork){var e=this;e.connectTimeout&&clearTimeout(e.connectTimeout),e.connectTimeout=setTimeout(function(){e.sendPing(),e.options.connect(e.websocket.isConnect),e.websocket.isConnect||3!=e.connectType||e.websocket&&e.websocket.readyState==WebSocket.CLOSED&&e.connect(),e.startTimeout()},1e3)}},endTimeout:function(){var e=this;e.connectTimeout&&clearTimeout(e.connectTimeout),e.connectTimeout=null},startReconnect:function(){var e=this;e.reconnectTimeout&&clearTimeout(e.reconnectTimeout),e.websocket&&e.websocket.isConnect||(e.connect(),e.reconnectTimeout=setTimeout(function(){e.startReconnect()},5e3))},doError:function(e){webSocket.hasOpend||(webSocket.isWork=!1,storage.set("webSocketIsWork",!1),a.resolve(!1)),console.log("Info: WebSocket error. code="+e.code)},doClose:function(e){var t=this;webSocket.hasOpend&&("1004"!=e.code&&"1006"!=e.code||webSocket.options.leaveCover(),"1006"==e.code&&webSocket.startReconnect(),console.log("Info: WebSocket closed. code="+e.code),console.log(e),t.isConnect=!1),webSocket.connectType=3},doMessage:function(e){console.log(e.data);var t=JSON.parse(e.data),o=t.type;if("WELCOME_TIPS"==o){var n=JSON.parse(t.content);webSocket.options.deal("CUTOMER_IS_INVITED",t.chatId,n.msg)}else if("CHAT"==o){var n=JSON.parse(t.content);webSocket.options.message(t.chatId,n.msg,t.messageId)}else if("CLOSE_ROOM"==o){var n=JSON.parse(t.content);"operatorLeaving"==n.msg?webSocket.options.deal("CLOSE",t.chatId,n.msg):webSocket.options.deal("CLOSE_CUSTOMER",t.chatId,n.msg)}else if("LEAVE_ROOM"==o){var n=JSON.parse(t.content);webSocket.options.deal("CLOSE_CUSTOMER",t.chatId,n.msg)}else if("RECEIPTS"==o){var n=JSON.parse(t.content);webSocket.options.deal("RECEIPT",t.chatId,n.targetMsgId)}else if("OPERATION_TIPS"==o){var n=JSON.parse(t.content);webSocket.options.deal(o,t.chatId,{params:n})}else if("REVOKE"==o){var n=JSON.parse(t.content);webSocket.options.deal("CUTOMER_REVOKE",t.chatId,t.messageId)}else if("VS_QUEUE_INDEX"==o){var n=JSON.parse(t.content);webSocket.options.deal("VS_QUEUE_INDEX",t.chatId,n)}else if("PONG"==o)webSocket.pongTime=(new Date).getTime();else if("DISCONNECTED_TIP"==o){var n=JSON.parse(t.content);webSocket.options.deal("CUSTOMER_NETWORK_INTERRUPT",t.chatId,n)}if("PONG"!=o&&"RECEIPTS"!=o&&null!=webSocket.websocket&&t.messageId){var c=new i(t.messageId);webSocket.websocket.send(JSON.stringify(c))}},close:function(e){var t=this;null!=t.websocket},send:function(e){var t=this;if(null!=t.websocket){var o=new c(e);t.options.confirmSend(o.messageId),t.websocket.send(JSON.stringify(o))}},queue:function(e){var t=this;if(null!=t.websocket){var o=new s(e);t.websocket.send(JSON.stringify(o))}}},t.webSocket=function(e){var t=new n(e);return t}}(window,jQuery);